---
layout: post
title: apache 关闭与重启
date: 2013-10-10 14:14
author: admin
comments: true
categories: []
---
2.4.6  关闭与重启

当你希望Apache停止运行或重新启动的时候，你必须向httpd进程发送关闭或重启信号。有两种发送信号的方法。第一种方法是直接使用UNIX的kill命令向运行中的进程发送信号。你也许会注意到系统里运行着很多httpd进程。但你不应该直接对它们中的任何一个发送信号，而只要对已经在PidFile中记载下了自身PID的父进程发送信号。也就是说，你不必对父进程以外的任何进程发送信号。你可以向父进程发送三种信号：TERM、HUP、USR1，比如：

kill -TERM `cat /usr/local/apache2/logs/httpd.pid`
第二种方法是apachectl控制脚本的 -k 命令行选项：stop、restart、graceful、graceful-stop，用来执行关闭、启动和重启。比如：

立即关闭，发送信号TERM。 

apachectl -k stop 
发送TERM或stop信号到父进程可以使它立刻杀死所有子进程。这将花费一些时间来杀死所有子进程。然后父进程自己也退出。所有进行中的请求将被强行中止，而且不再接受其他请求。

立即重启，发送信号HUP。

apachectl -k restart 
向父进程发送HUP或restart信号会使它像收到TERM信号一样杀掉所有的子进程，不同之处在于父进程本身并不退出。它重新读入配置文件、重新打开日志文件。然后产生一系列新的子进程来继续服务。

优雅重启，发送信号USR1。

apachectl -k graceful 
USR1或graceful信号使得父进程建议子进程在完成它们现在的请求后退出（如果它们没有进行服务，将会立刻退出）。父进程重新读入配置文件并重新打开日志文件。当一个子进程死掉时，父进程立刻用新的配置文件产生一个新的子进程并立刻开始伺服新的请求。

优雅停止，发送信号WINCH。

apachectl -k graceful-stop 
WINCH或graceful-stop信号使得父进程建议子进程在完成它们现在的请求后退出（如果它们没有进行服务，将会立刻退出）。然后父进程删除PidFile并停止在所有端口上的监听。父进程仍然继续运行并监视正在处理请求的子进程，一旦所有子进程完成任务并退出或超过由GracefulShutdownTimeout指令规定的时间，父进程将会退出。在超时的情况下，所有子进程都将接收到TERM信号并被强制退出。

在"优雅"状态下，TERM信号将会立即中止父进程和所有子进程。由于PidFile已经被删除，你将无法使用apachectl或httpd发送该信号。

当你向httpd发送信号时，你可以这样来读取它的进行过程：

tail -f /usr/local/apache2/logs/error_log
