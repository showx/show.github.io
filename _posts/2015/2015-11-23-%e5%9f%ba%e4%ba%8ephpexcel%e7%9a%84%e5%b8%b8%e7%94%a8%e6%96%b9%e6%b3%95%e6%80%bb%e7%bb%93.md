---
layout: post
title: 基于PHPExcel的常用方法总结
date: 2015-11-23 16:55
author: admin
comments: true
categories: []
---
<div class="codetitle">代码如下:</div>
<div id="code44916" class="codebody">
// 通常PHPExcel对象有两种实例化的方式
// 1. 通过new关键字创建空白文档
$phpexcel = newPHPExcel();
// 2. 通过读取已有的模板创建
$phpexcel =PHPExcel_IOFactory::createReader("Excel5")-&gt;load("template.xls");</div>
&nbsp;
<div class="codetitle"><a id="copybut36630" class="copybut"></a><u>复制代码</u>代码如下:</div>
<div id="code36630" class="codebody">
&lt;?
//设置PHPExcel类库的include path
set_include_path('.'. PATH_SEPARATOR .
'D:\Zeal\PHP_LIBS' . PATH_SEPARATOR .
get_include_path());
/**
* 以下是使用示例，对于以 //// 开头的行是不同的可选方式，请根据实际需要
* 打开对应行的注释。
* 如果使用 Excel5 ，输出的内容应该是GBK编码。
*/
require_once 'PHPExcel.php';
// uncomment
////require_once 'PHPExcel/Writer/Excel5.php';    // 用于其他低版本xls
// or
////require_once 'PHPExcel/Writer/Excel2007.php'; // 用于 excel-2007 格式
// 创建一个处理对象实例
$objExcel = new PHPExcel();
// 创建文件格式写入对象实例, uncomment
////$objWriter = new PHPExcel_Writer_Excel5($objExcel);    // 用于其他版本格式
// or
////$objWriter = new PHPExcel_Writer_Excel2007($objExcel); // 用于 2007 格式
//$objWriter-&gt;setOffice2003Compatibility(true);
//*************************************
//设置文档基本属性
$objProps = $objExcel-&gt;getProperties();
$objProps-&gt;setCreator("Zeal Li");
$objProps-&gt;setLastModifiedBy("Zeal Li");
$objProps-&gt;setTitle("Office XLS Test Document");
$objProps-&gt;setSubject("Office XLS Test Document, Demo");
$objProps-&gt;setDescription("Test document, generated by PHPExcel.");
$objProps-&gt;setKeywords("office excel PHPExcel");
$objProps-&gt;setCategory("Test");
//*************************************
//设置当前的sheet索引，用于后续的内容操作。
//一般只有在使用多个sheet的时候才需要显示调用。
//缺省情况下，PHPExcel会自动创建第一个sheet被设置SheetIndex=0
$objExcel-&gt;setActiveSheetIndex(0);$objActSheet = $objExcel-&gt;getActiveSheet();
//设置当前活动sheet的名称
$objActSheet-&gt;setTitle('测试Sheet');
//*************************************
//设置单元格内容
//
//由PHPExcel根据传入内容自动判断单元格内容类型
$objActSheet-&gt;setCellValue('A1', '字符串内容');  // 字符串内容
$objActSheet-&gt;setCellValue('A2', 26);            // 数值
$objActSheet-&gt;setCellValue('A3', true);          // 布尔值
$objActSheet-&gt;setCellValue('A4', '=SUM(A2:A2)'); // 公式
//显式指定内容类型
$objActSheet-&gt;setCellValueExplicit('A5', '847475847857487584',
PHPExcel_Cell_DataType::TYPE_STRING);
//合并单元格
$objActSheet-&gt;mergeCells('B1:C22');
//分离单元格
$objActSheet-&gt;unmergeCells('B1:C22');
//*************************************
//设置单元格样式
//
//设置宽度
$objActSheet-&gt;getColumnDimension('B')-&gt;setAutoSize(true);
$objActSheet-&gt;getColumnDimension('A')-&gt;setWidth(30);
$objStyleA5 = $objActSheet-&gt;getStyle('A5');
//设置单元格内容的数字格式。
//
//如果使用了 PHPExcel_Writer_Excel5 来生成内容的话，
//这里需要注意，在 PHPExcel_Style_NumberFormat 类的 const 变量定义的
//各种自定义格式化方式中，其它类型都可以正常使用，但当setFormatCode
//为 FORMAT_NUMBER 的时候，实际出来的效果被没有把格式设置为"0"。需要
//修改 PHPExcel_Writer_Excel5_Format 类源代码中的 getXf($style) 方法，
//在 if ($this-&gt;_BIFF_version == 0x0500) { （第363行附近）前面增加一
//行代码:
//if($ifmt === '0') $ifmt = 1;
//
//设置格式为PHPExcel_Style_NumberFormat::FORMAT_NUMBER，避免某些大数字
//被使用科学记数方式显示，配合下面的 setAutoSize 方法可以让每一行的内容
//都按原始内容全部显示出来。
$objStyleA5
-&gt;getNumberFormat()
-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_NUMBER);
//设置字体
$objFontA5 = $objStyleA5-&gt;getFont();
$objFontA5-&gt;setName('Courier New');
$objFontA5-&gt;setSize(10);
$objFontA5-&gt;setBold(true);
$objFontA5-&gt;setUnderline(PHPExcel_Style_Font::UNDERLINE_SINGLE);
$objFontA5-&gt;getColor()-&gt;setARGB('FF999999');
//设置对齐方式
$objAlignA5 = $objStyleA5-&gt;getAlignment();
$objAlignA5-&gt;setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
$objAlignA5-&gt;setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
//设置边框
$objBorderA5 = $objStyleA5-&gt;getBorders();
$objBorderA5-&gt;getTop()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);
$objBorderA5-&gt;getTop()-&gt;getColor()-&gt;setARGB('FFFF0000'); // color
$objBorderA5-&gt;getBottom()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);
$objBorderA5-&gt;getLeft()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);
$objBorderA5-&gt;getRight()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);
//设置填充颜色
$objFillA5 = $objStyleA5-&gt;getFill();
$objFillA5-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID);
$objFillA5-&gt;getStartColor()-&gt;setARGB('FFEEEEEE');
//从指定的单元格复制样式信息.
$objActSheet-&gt;duplicateStyle($objStyleA5, 'B1:C22');

//*************************************
//添加图片
$objDrawing = new PHPExcel_Worksheet_Drawing();
$objDrawing-&gt;setName('ZealImg');
$objDrawing-&gt;setDescription('Image inserted by Zeal');
$objDrawing-&gt;setPath('./zeali.net.logo.gif');
$objDrawing-&gt;setHeight(36);
$objDrawing-&gt;setCoordinates('C23');
$objDrawing-&gt;setOffsetX(10);
$objDrawing-&gt;setRotation(15);
$objDrawing-&gt;getShadow()-&gt;setVisible(true);
$objDrawing-&gt;getShadow()-&gt;setDirection(36);
$objDrawing-&gt;setWorksheet($objActSheet);

//添加一个新的worksheet
$objExcel-&gt;createSheet();
$objExcel-&gt;getSheet(1)-&gt;setTitle('测试2');
//保护单元格
$objExcel-&gt;getSheet(1)-&gt;getProtection()-&gt;setSheet(true);
$objExcel-&gt;getSheet(1)-&gt;protectCells('A1:C22', 'PHPExcel');

//*************************************
//输出内容
//
$outputFileName = "output.xls";
//到文件
////$objWriter-&gt;save($outputFileName);
//or
//到浏览器
////header("Content-Type: application/force-download");
////header("Content-Type: application/octet-stream");
////header("Content-Type: application/download");
////header('Content-Disposition:inline;filename="'.$outputFileName.'"');
////header("Content-Transfer-Encoding: binary");
////header("Expires: Mon, 26 Jul 1997 05:00:00 GMT");
////header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");
////header("Cache-Control: must-revalidate, post-check=0, pre-check=0");
////header("Pragma: no-cache");
////$objWriter-&gt;save('php://output');
?&gt;

</div>
