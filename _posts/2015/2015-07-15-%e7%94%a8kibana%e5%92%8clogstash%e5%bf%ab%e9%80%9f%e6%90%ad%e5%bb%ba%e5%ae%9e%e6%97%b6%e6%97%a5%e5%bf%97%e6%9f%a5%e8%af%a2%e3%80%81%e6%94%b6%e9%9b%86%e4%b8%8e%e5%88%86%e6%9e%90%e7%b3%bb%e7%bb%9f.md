---
layout: post
title: 用Kibana和logstash快速搭建实时日志查询、收集与分析系统
date: 2015-07-15 10:01
author: admin
comments: true
categories: []
---
Logstash是一个完全开源的工具，他可以对你的日志进行收集、分析，并将其存储供以后使用（如，搜索），您可以使用它。说到搜索，logstash带有一个web界面，搜索和展示所有日志。
kibana 也是一个开源和免费的工具，他可以帮助您汇总、分析和搜索重要数据日志并提供友好的web界面。他可以为 Logstash 和 ElasticSearch 提供的日志分析的 Web 界面
说到这里，我们看看 kibana 和 logstash到底能为我们做些什么呢？下面是kibana的界面

<a href="http://img1.51cto.com/attachment/201303/131035239.png" target="_blank"><img style="padding: 0px; margin: 0px; vertical-align: top; border: none;" src="http://img1.51cto.com/attachment/201303/131035239.png" alt="" width="650" border="0" /></a>
简单来讲他具体的工作流程就是 logstash agent 监控并过滤日志，将过滤后的日志内容发给redis(这里的redis只处理队列不做存储)，logstash index将日志收集在一起交给
全文搜索服务ElasticSearch 可以用ElasticSearch进行自定义搜索 通过Kibana 来结合 自定义搜索进行页面展示，下图是 Kibana官网上的流程图

<a href="http://img1.51cto.com/attachment/201303/131135111.png" target="_blank"><img style="padding: 0px; margin: 0px; vertical-align: top; border: none;" src="http://img1.51cto.com/attachment/201303/131135111.png" alt="" border="0" /></a>

好了 让我们一步步的把这套环境搭建起来吧，先看看都需要安装什么软件包
ruby 运行Kibana 必须，
rubygems 安装ruby扩展必须
bundler 功能类似于yum
JDK 运行java程序必须
redis 用来处理日志队列
logstash 收集、过滤日志
ElasticSearch 全文搜索服务(logstash集成了一个)
kibana 页面展示
这里有三台服务器
192.168.233.128 logstash index，ElasticSearch，kibana，JDK
192.168.233.129 logstash agent，JDK
192.168.233.130 redis

首先到 logstash index服务器上面，logstash分为 index和aget ，agent负责监控、过滤日志，index负责收集日志并将日志交给ElasticSearch 做搜索

此外 logstash 的收集方式分为 standalone 和 centralized。
standalone 是所有功能都在一个服务器上面，自发自收，centralized 就是集中收集，一台服务器接收所有shipper(个人理解就是logstash agent)的日志。
其实 logstash本身不分 什么 shipper 和 collector ，只不过就是配置文件不同而已，我们这次按照集中的方式来测试
在 logstash index上安装基础的软件环境
<ol class="dp-sql">
	<li class="alt">[192.168.233.128 root@nodec:~]</li>
	<li># cd /soft/</li>
	<li class="alt">[192.168.233.128 root@nodec:/soft]</li>
	<li># wget http://down1.chinaunix.net/distfiles/jdk-6u13-dlj-linux-i586.bin</li>
	<li class="alt">从oracle下载实在是太慢了，从CU下载会快一些，如果需要最新版本请访问这里</li>
	<li>http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html</li>
	<li class="alt">[192.168.233.128 root@nodec:/soft]</li>
	<li># sh jdk-6u13-dlj-linux-i586.bin</li>
	<li class="alt">输入yes 便开始安装了</li>
	<li>安装完成后设置一下 JAVA_HOME</li>
	<li class="alt">[192.168.233.128 root@nodec:/soft/Kibana-0.2.0]</li>
	<li># vim /etc/profile</li>
	<li class="alt">export JAVA_HOME=/usr/java</li>
	<li>export PATH=$JAVA_HOME/bin:$PATH</li>
	<li class="alt">export CLASSPATH=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:$CLASSPATH</li>
	<li></li>
	<li class="alt">安装ruby 就比较简单了(Kibana需要ruby 1.8.7以上版本)</li>
	<li>[192.168.233.128 root@nodec:/soft]</li>
	<li class="alt"># yum install ruby rubygems</li>
	<li>..... 安装内容省略</li>
	<li class="alt">安装完成后用 rubygems 来安装bundler</li>
	<li>[192.168.233.128 root@nodec:/soft]</li>
	<li class="alt"># /usr/bin/gem install bundler</li>
	<li>.....</li>
	<li class="alt"></li>
	<li>ok 这样基本的环境就已经有了，下面就是安装kibana 和 logstash</li>
	<li class="alt">其实logstash 就是一个java脚本，不需要安装... 下载即用</li>
	<li>[192.168.233.128 root@nodec:/soft]</li>
	<li class="alt"># wget http://logstash.objects.dreamhost.com/release/logstash-1.1.0-monolithic.jar</li>
	<li>现在看看 这个脚本应该怎么去执行</li>
	<li class="alt">[192.168.233.128 root@nodec:/soft]</li>
	<li># java -jar /soft/logstash-1.1.0-monolithic.jar -h</li>
	<li class="alt"><span class="keyword">No</span> such command <span class="string">"-h"</span></li>
	<li>Available commands:</li>
	<li class="alt">  -v</li>
	<li>  -V</li>
	<li class="alt">  <span class="comment">--version</span></li>
	<li>  agent</li>
	<li class="alt">  web</li>
	<li>  test</li>
	<li class="alt">显然没有 -h 参数，不过列出了能用的参数，但是logstash的参数可不止这些，</li>
	<li>java -jar /soft/logstash-1.1.0-monolithic.jar agent <span class="comment">--help</span></li>
	<li class="alt">这些是在agent模式下的命令参数</li>
	<li>-f, <span class="comment">--config CONFIGFILE</span></li>
	<li class="alt">    <span class="keyword">Load</span> the logstash config <span class="keyword">from</span> a specific file, directory, <span class="op">or</span> a wildcard. If given a directory <span class="op">or</span> wildcard, config files will be <span class="keyword">read</span> <span class="op">in</span> <span class="keyword">order</span> lexigraphically.</li>
	<li>-e CONFIGSTRING</li>
	<li class="alt">    Use the given string <span class="keyword">as</span> the configuration data. Same syntax <span class="keyword">as</span> the config file. If <span class="op">not</span> input <span class="keyword">is</span> specified, <span class="string">'stdin { type =&gt; stdin }'</span> <span class="keyword">is</span> <span class="keyword">default</span>. If <span class="keyword">no</span> <span class="keyword">output</span> <span class="keyword">is</span> specified, <span class="string">'stdout { debug =&gt; true }}'</span> <span class="keyword">is</span> <span class="keyword">default</span>.</li>
	<li>-w, <span class="comment">--filterworks COUNT</span></li>
	<li class="alt">    Run <span class="func">COUNT</span> filter workers (<span class="keyword">default</span>: 1)</li>
	<li><span class="comment">--watchdog-timeout TIMEOUT</span></li>
	<li class="alt">    <span class="keyword">Set</span> watchdog timeout value.</li>
	<li>-l, <span class="comment">--log FILE</span></li>
	<li class="alt">    Log <span class="keyword">to</span> a given path. <span class="keyword">Default</span> <span class="keyword">is</span> <span class="keyword">to</span> log <span class="keyword">to</span> stdout</li>
	<li>-v</li>
	<li class="alt">    Increase verbosity. There are multiple levels <span class="keyword">of</span> verbosity available <span class="keyword">with</span> <span class="string">'-vv'</span> currently being the highest</li>
	<li><span class="comment">--pluginpath PLUGIN_PATH</span></li>
	<li class="alt">    A colon-delimted path <span class="keyword">to</span> find other logstash plugins <span class="op">in</span></li>
	<li>java -jar /soft/logstash-1.1.0-monolithic.jar web <span class="comment">--help</span></li>
	<li class="alt">下面的是在web界面的参数</li>
	<li><span class="comment">--log FILE</span></li>
	<li class="alt">    Log <span class="keyword">to</span> a given path. <span class="keyword">Default</span> <span class="keyword">is</span> stdout.</li>
	<li><span class="comment">--address ADDRESS</span></li>
	<li class="alt">    Address <span class="keyword">on</span> which <span class="keyword">to</span> start webserver. <span class="keyword">Default</span> <span class="keyword">is</span> 0.0.0.0.</li>
	<li><span class="comment">--port PORT</span></li>
	<li class="alt">    Port <span class="keyword">on</span> which <span class="keyword">to</span> start webserver. <span class="keyword">Default</span> <span class="keyword">is</span> 9292.</li>
	<li>-B, <span class="comment">--elasticsearch-bind-host ADDRESS</span></li>
	<li class="alt">    Address <span class="keyword">on</span> which <span class="keyword">to</span> bind elastic search node.</li>
	<li>-b, <span class="comment">--backend URL</span></li>
	<li class="alt">    The backend URL <span class="keyword">to</span> use. <span class="keyword">Default</span> <span class="keyword">is</span> elasticsearch:/// (assumes multicast discovery). You can specify elasticsearch://[host][:port]/[clustername]</li>
</ol>
<pre>如果上面的这些命令都能执行正常的话就表示 logstash可以使用了，但要让他启动还需要一个配置文件

</pre>
<ol class="dp-sql">
	<li class="alt">[192.168.233.128 root@nodec:/soft]</li>
	<li></li>
	<li class="alt"># vim redis.conf</li>
	<li></li>
	<li class="alt">input {</li>
	<li class="alt">redis {</li>
	<li class="alt">  host =&gt; <span class="string">'192.168.233.130'</span></li>
	<li class="alt">  data_type =&gt; <span class="string">'list'</span></li>
	<li class="alt">  port =&gt; <span class="string">"6379"</span></li>
	<li class="alt">  <span class="keyword">key</span> =&gt; <span class="string">'logstash:redis'</span></li>
	<li class="alt">  type =&gt; <span class="string">'redis-input'</span></li>
	<li class="alt">       }</li>
	<li class="alt">       }</li>
	<li class="alt"></li>
	<li class="alt"><span class="keyword">output</span> {</li>
	<li class="alt">    elasticsearch {</li>
	<li class="alt">    embedded =&gt; <span class="keyword">true</span></li>
	<li class="alt">                  }</li>
	<li class="alt">       }</li>
</ol>
<pre>解释一下 logstash的配置文件由 input filter output 等几个基本的部分组成，顾名思义 input 就是在那收集数据，output就是输出到哪，filter代表一个过滤规则意思是什么内容
会被收集。
上面这段是让 logstash 去192.168.233.130 这个redis服务器上去收集日志 redis端口为6379，key是 logstash:redis 类型为 redis-input ，（注意:这几个值必须跟logstash agent的
output 所对应），收集完成后输出到 elasticsearch ,embedded =&gt; true 的意思是使用logstash 内嵌的 elasticsearch。如果有独立的elasticsearch服务器，需要将 这条改为
host =&gt; 'elasticsearch的ip' port =&gt; 端口
好了，这个简单的配置文件可以让logstash开始启动了

</pre>
<ol class="dp-sql">
	<li class="alt">[192.168.233.128 root@nodec:/soft]</li>
	<li># java -jar /soft/logstash-1.1.0-monolithic.jar agent -f /soft/redis.conf <span class="comment">-- web --backend elasticsearch:///?local &amp;</span></li>
	<li class="alt">[1] 5205</li>
	<li>...这里要等待约5秒钟... 为什么？去问开发者吧</li>
	<li class="alt">[192.168.233.128 root@nodec:/soft]</li>
	<li># I, [2013-03-19T03:23:10.749000 #5205]  INFO <span class="comment">-- : Using beta plugin 'redis'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status  {"timestamp":"2013-03-19T03:23:10.732000 -0700","message":"Using beta plugin 'redis'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status ","level":"info"}</span></li>
	<li class="alt">file:/soft/logstash-1.1.0-monolithic.jar!/gems/rack-1.3.4/lib/rack/backports/uri/common_192.rb:53 warning: already initialized constant WFKV_</li>
	<li>Mizuno 0.5.0 (Jetty 8.0.y.z-SNAPSHOT) listening <span class="keyword">on</span> 0.0.0.0:9292</li>
	<li class="alt">解释一下 上面的命令 agent 代理模式 -f 指定配置文件 <span class="comment">--web 其实是个分隔符等于又启动了一个命令，后面的参数就是开启一个web页面默认端口是9292,这个命令如果拆成两个就是这个样子</span></li>
	<li>java -jar /soft/logstash-1.1.0-monolithic.jar agent -f /soft/redis.conf &amp;</li>
	<li class="alt">java -jar /soft/logstash-1.1.0-monolithic.jar web <span class="comment">--backend elasticsearch:///?local &amp;</span> (其实如果用kibana来做web界面的话这一步完全可以省掉了)</li>
</ol>
<pre>好了，看到9292 端口启动就代表 启动成功了，检查一下

</pre>
<ol class="dp-sql">
	<li class="alt">[192.168.233.128 root@nodec:/soft]</li>
	<li># lsof -i:9292</li>
	<li class="alt">COMMAND  PID <span class="func">USER</span>   FD   TYPE DEVICE <span class="keyword">SIZE</span> NODE <span class="keyword">NAME</span></li>
	<li>java    5205 root  465u  IPv4 130805       TCP *:armtechdaemon (LISTEN)</li>
	<li class="alt">其实logstash还启动了一个端口9200，因为启动了内嵌的 elasticsearch，这个9200是 elasticsearch在监听</li>
	<li>[192.168.233.128 root@nodec:/soft]</li>
	<li class="alt"># lsof -i:9200</li>
	<li>COMMAND  PID <span class="func">USER</span>   FD   TYPE DEVICE <span class="keyword">SIZE</span> NODE <span class="keyword">NAME</span></li>
	<li class="alt">java    5205 root  160u  IPv4 130682       TCP *:wap-wsp (LISTEN)</li>
</ol>
<pre>现在可以通过浏览器访问一下 http://192.168.233.128:9292 看看logstash是的页面是个什么样子

</pre>
<a href="http://img1.51cto.com/attachment/201303/133957451.jpg" target="_blank"><img style="padding: 0px; margin: 0px; vertical-align: top; border: none;" src="http://img1.51cto.com/attachment/201303/133957451.jpg" alt="" width="650" border="0" /></a>现在还不能搜索因为现在还没有数据，其实这个时候 http://192.168.233.128:9200 也是可以访问的，
很多开发自己写代码来调用elasticsearch 来实现他们自己的需要，这里就不多说了
192.168.233.128 这台logstash index的操作暂时告一段落，下面开始配置logstash的agent
登录到 服务器 192.168.233.129 安装基本软件包和logstash
<ol class="dp-sql">
	<li class="alt">[192.168.233.129 root@noded:~]</li>
	<li># cd /soft/</li>
	<li class="alt">[192.168.233.129 root@noded:/soft]</li>
	<li># wget http://down1.chinaunix.net/distfiles/jdk-6u13-dlj-linux-i586.bin</li>
	<li class="alt">[192.168.233.129 root@noded:/soft]</li>
	<li># sh jdk-6u13-dlj-linux-i586.bin</li>
	<li class="alt">设置 JAVA_HOME</li>
	<li>[192.168.233.129 root@noded:/soft]</li>
	<li class="alt"># vim /etc/profile</li>
	<li>export JAVA_HOME=/usr/java</li>
	<li class="alt">export PATH=$JAVA_HOME/bin:$PATH</li>
	<li>export CLASSPATH=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:$CLASSPATH</li>
	<li class="alt">[192.168.233.129 root@noded:/soft]</li>
	<li># yum install ruby</li>
	<li class="alt">192.168.233.129 root@noded:/soft]</li>
	<li># wget http://logstash.objects.dreamhost.com/release/logstash-1.1.0-monolithic.jar</li>
	<li class="alt">[192.168.233.129 root@noded:/soft]</li>
	<li># vim redis.conf</li>
	<li class="alt">input {</li>
	<li>    file {</li>
	<li class="alt">    type =&gt; <span class="string">"producer"</span></li>
	<li>    path =&gt; <span class="string">"/soft/apache.log"</span></li>
	<li class="alt">    }</li>
	<li>    file {</li>
	<li class="alt">    type =&gt; <span class="string">"php-log"</span></li>
	<li>    path =&gt; <span class="string">"/soft/php.log"</span></li>
	<li class="alt">    }</li>
	<li>}</li>
	<li class="alt">filter {</li>
	<li>       grep {</li>
	<li class="alt">       match =&gt; [ <span class="string">"@message"</span>, <span class="string">"mysql|GET|error"</span> ]</li>
	<li>            }</li>
	<li class="alt">       }</li>
	<li></li>
	<li class="alt"><span class="keyword">output</span> {</li>
	<li>      redis {</li>
	<li class="alt">      host =&gt; <span class="string">'192.168.233.130'</span></li>
	<li>      data_type =&gt; <span class="string">'list'</span></li>
	<li class="alt">      <span class="keyword">key</span> =&gt; <span class="string">'logstash:redis'</span></li>
	<li>       }</li>
	<li class="alt">       }</li>
</ol>
大概说一下这个配置文件 input 里的file就是要监视的文件了 这里我监视了两个文件，如果这两个文件有追加的内容就会通过下面的output设置发给 redis服务器
filter 里的grep 意思就是 grep...  后面这段就是 日志内容里面只要有匹配 mysql或GET或error的内容就会被过滤出来，发送到 logstash index
以上就是一个比较简单的配置文件了，让我们启动他
<ol class="dp-sql">
	<li class="alt">[192.168.233.129 root@noded:/soft]</li>
	<li># java -jar /soft/logstash-1.1.0-monolithic.jar agent -f /soft/redis.conf &amp;</li>
	<li class="alt">I, [2013-03-19T19:45:35.762000 #2721]  INFO <span class="comment">-- : Using beta plugin 'file'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status  {"timestamp":"2013-03-19T19:45:35.752000 -0700","message":"Using beta plugin 'file'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status ","level":"info"}</span></li>
	<li>I, [2013-03-19T19:45:35.778000 #2721]  INFO <span class="comment">-- : Using beta plugin 'file'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status  {"timestamp":"2013-03-19T19:45:35.778000 -0700","message":"Using beta plugin 'file'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status ","level":"info"}</span></li>
	<li class="alt">I, [2013-03-19T19:45:35.804000 #2721]  INFO <span class="comment">-- : Using beta plugin 'grep'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status  {"timestamp":"2013-03-19T19:45:35.803000 -0700","message":"Using beta plugin 'grep'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status ","level":"info"}</span></li>
	<li>I, [2013-03-19T19:45:35.854000 #2721]  INFO <span class="comment">-- : Using beta plugin 'redis'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status  {"timestamp":"2013-03-19T19:45:35.853000 -0700","message":"Using beta plugin 'redis'. For more information about plugin statuses, see http://logstash.net/docs/1.1.0/plugin-status ","level":"info"}</span></li>
</ol>
只要没有 warning 和 error就算是正常启动了
启动之前请确定 192.168.233.130的 redis服务器已经启动，不然会报错
下面登录到 192.168.233.130 上看看 redis服务的状态
<ol class="dp-sql">
	<li class="alt">[192.168.233.130 root@nodea:/data/redis/etc]</li>
	<li># lsof -i:6379</li>
	<li class="alt">COMMAND    PID <span class="func">USER</span>   FD   TYPE DEVICE <span class="keyword">SIZE</span> NODE <span class="keyword">NAME</span></li>
	<li>redis-ser 2732 root    4u  IPv4   7946       TCP *:6379 (LISTEN)</li>
	<li class="alt">redis-ser 2732 root    5u  IPv4   7963       TCP localhost.localdomain:6379-&gt;localhost.localdomain:19214 (ESTABLISHED)</li>
	<li>java      2733 root    9u  IPv4   7959       TCP localhost.localdomain:19214-&gt;localhost.localdomain:6379 (ESTABLISHED)</li>
	<li class="alt">状态正常，端口处于监听状态，我用的是最简单的 配置，</li>
	<li>[192.168.233.130 root@nodea:/data/redis/etc]</li>
	<li class="alt"># vim redis.conf</li>
	<li>#this <span class="keyword">is</span> the config file <span class="keyword">for</span> redis</li>
	<li class="alt">pidfile /var/run/redis.pid</li>
	<li>port 6379</li>
	<li class="alt">timeout 0</li>
	<li>loglevel verbose</li>
	<li class="alt">logfile /data/redis/log/redis.log</li>
	<li>dbfilename dump.rdb</li>
	<li class="alt">dir /data/redis/db/</li>
	<li>vm-swap-file /tmp/redis.swap</li>
	<li class="alt">activerehashing yes</li>
	<li>启动命令如下</li>
	<li class="alt">[192.168.233.130 root@nodea:/data/redis/etc]</li>
	<li># redis-server /data/redis/etc/redis.conf &amp;</li>
</ol>
下载安装就比较简单了
<ol class="dp-sql">
	<li class="alt">[192.168.233.130 root@nodea:/soft]</li>
	<li># wget http://redis.googlecode.com/files/redis-2.4.14.tar.gz</li>
	<li class="alt">[192.168.233.130 root@nodea:/data/redis/etc]</li>
	<li># make –j24</li>
	<li class="alt">[192.168.233.130 root@nodea:/data/redis/etc]</li>
	<li># make install</li>
</ol>
配置文件里的那几个路径要提前建好

最后我们回到 logstash agent 上面测试一下
<ol class="dp-sql">
	<li class="alt">[192.168.233.129 root@noded:/soft]</li>
	<li># echo GET12313 &gt;&gt; apache.log</li>
	<li class="alt">[192.168.233.129 root@noded:/soft]</li>
	<li># echo errorabcd &gt;&gt; apache.log</li>
</ol>
ok 到 http://192.168.233.128:9292 去搜索一下 刚才的两个内容

<a href="http://img1.51cto.com/attachment/201303/132952247.jpg" target="_blank"><img style="padding: 0px; margin: 0px; vertical-align: top; border: none;" src="http://img1.51cto.com/attachment/201303/132952247.jpg" alt="" width="650" border="0" /></a>

<a href="http://img1.51cto.com/attachment/201303/133019112.jpg" target="_blank"><img style="padding: 0px; margin: 0px; vertical-align: top; border: none;" src="http://img1.51cto.com/attachment/201303/133019112.jpg" alt="" width="650" border="0" /></a>
嗯，就是这样了，我现在找个php的错误日志给他追加到php.log文件里
[192.168.233.129 root@noded:/soft]
# cat php-error.log &gt;&gt; php.log
在看看 logstash的页面 搜索一下 error

<a href="http://img1.51cto.com/attachment/201303/202133777.jpg" target="_blank"><img style="padding: 0px; margin: 0px; vertical-align: top; border: none;" src="http://img1.51cto.com/attachment/201303/202133777.jpg" alt="" width="650" border="0" /></a>
OK，最后就是 Kibana了 ，我把Kibana装在了 logstash index上面
下载地址为 http://kibana.org/intro.html
<ol class="dp-sql">
	<li class="alt">[192.168.233.128 root@nodec:/soft]</li>
	<li># tar xf Kibana-0.2.0.tar.gz</li>
	<li class="alt">[192.168.233.128 root@nodec:/soft]</li>
	<li># cd Kibana-0.2.0</li>
	<li class="alt">[192.168.233.128 root@nodec:/soft/Kibana-0.2.0]</li>
	<li># bundle install</li>
	<li class="alt">直接安装就好了，非常简单，因为之前咱们已经安装好了 bundle</li>
	<li>编辑配置文件，指定 elasticsearch 的位置</li>
	<li class="alt">[192.168.233.128 root@nodec:/soft/Kibana-0.2.0]</li>
	<li># vim KibanaConfig.rb</li>
	<li class="alt">.....</li>
	<li>  Elasticsearch = <span class="string">"localhost:9200"</span></li>
	<li class="alt">  KibanaPort = 5601</li>
	<li>  KibanaHost = <span class="string">'0.0.0.0'</span></li>
	<li class="alt">.....</li>
	<li>主要是这几个参数</li>
	<li class="alt">启动的话需要ruby</li>
	<li>[192.168.233.128 root@nodec:/soft/Kibana-0.2.0]</li>
	<li class="alt"># /usr/bin/ruby kibana.rb &amp;</li>
	<li>[192.168.233.128 root@nodec:/soft/Kibana-0.2.0]</li>
	<li class="alt"># == Sinatra/1.3.5 has taken the stage <span class="keyword">on</span> 5601 <span class="keyword">for</span> development <span class="keyword">with</span> backup <span class="keyword">from</span> Thin</li>
	<li>&gt;&gt; Thin web server (v1.5.0 codename Knife)</li>
	<li class="alt">&gt;&gt; Maximum connections <span class="keyword">set</span> <span class="keyword">to</span> 1024</li>
	<li>&gt;&gt; Listening <span class="keyword">on</span> 0.0.0.0:5601, CTRL+C <span class="keyword">to</span> stop</li>
	<li class="alt">如果ruby的东西都不缺的话，启动会很顺利，ok 现在看看5601端口的状态</li>
	<li>[192.168.233.128 root@nodec:/soft/Kibana-0.2.0]</li>
	<li class="alt"># lsof -i:5601</li>
	<li>COMMAND  PID <span class="func">USER</span>   FD   TYPE DEVICE <span class="keyword">SIZE</span> NODE <span class="keyword">NAME</span></li>
	<li class="alt">ruby    3116 root    5u  IPv4  28947       TCP *:esmagent (LISTEN)</li>
</ol>
访问一下 试试看 http://192.168.233.128:5601 尝试搜索一下php的错误日志，比如mysql

<a href="http://img1.51cto.com/attachment/201303/133220759.jpg" target="_blank"><img style="padding: 0px; margin: 0px; vertical-align: top; border: none;" src="http://img1.51cto.com/attachment/201303/133220759.jpg" alt="" width="650" border="0" /></a>
呵呵，要的就是这个效果，日志会实时的汇总到 logstash index 上供我们查询，当然这只是开始使用logstash的第一步而已，更多的高级功能可以看看官方文档
http://logstash.net/docs/1.1.9/
