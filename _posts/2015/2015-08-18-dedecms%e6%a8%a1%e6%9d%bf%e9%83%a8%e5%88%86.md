---
layout: post
title: dedecms模板部分
date: 2015-08-18 18:04
author: admin
comments: true
categories: []
---
核心类文件
include/dedetemplate.class.php
用途：用于非核心模块的动态页面或列表页的模板解析，如：member/content_list.php ，通常是在 datalistcp.class.php 中使用，这个类在动态运行的情况下，由于本身是把模板编译成PHP的，因此性能上会优级于旧的解析类，这个方法将在未来版本中作为通用的方式。
 
一、使用方法：
 
$tpl = new DedeTemplate(
模板对象实例名称，通常是'tpl',
[模板存放目录（生成缓存时会存放在这个目录）,
include语法默认引用目录]
);
通常情况下参数二和参数三是不必要的，如：
$tpl = new DedeTemplate('tpl');
 
如果在类文件中调用，应该加上设置：
$this->tpl->SetObject($this);
在一些块调用中默认将使用当前类的成员函数。
 
$tpl->LoadTemplate(模板的物理路径);
 
如果模板中带有 {dede:config name='' value=''/}
可以在载入模板后，通过 $tpl->GetConfig($name) 获得这些变量的值。
 
显示页面或保存页面为文件
$tpl->Display();
$tpl->SaveTo(物理绝对路径的文件名);
 
 
二、模板标记语法
 
1、标记通用特性
(1) 短标记
{dede:tagname.name/}
等同于
{dede:tagname name='' /}
(2) 块标记
{dede:tagname}
循环代码
{/dede:tagname}
 
 
2、标记的具体语法及对应的PHP代码
(1) 配置变量
{dede:config name='' value=''/}
配置变量可以在载入模板后通过 $tpl->GetConfig($name) 获得，仅作为配置，不在模板中显示。
 
(2) 短标记
 
{dede:global.name/}   外部变量      等同于 <?php echo $name; ?>
{dede:var.name/}      var数组       等同于 <?php echo $_vars['name']; ?>
{dede:field.name/}    field数组     等同于 <?php echo $fields['name']; ?>
{dede:cfg.name/}      系统配置变量  等同于<?php echo $cfg_name; ?>
 
考虑到大多数情况下都会在函数或类中调用模板，因此 $_vars、$fields 数组必须声明为 global 数组，否则模板引擎无法获得它的值从而导致产生错误。
 
(3) 自由调用块标记
{tag:blockname bind='GetArcList' bindtype='class'}
循环代码
{/tag:blockname}
 
必要属性：
bind       数据源来源函数
bindtype   函数类型，默认是 class 可选为 sub
rstype     返回结果类型，默认是 array ，可选项为 string
 
自定义函数格式必须为 function(array $atts,object $refObj, array $fields);
在没有指定 bind 绑定的函数的情况下，默认指向MakePublicTag($atts,$tpl->refObj,$fields) 统一管理，这个函数存放在 cls_dede_tplinc.php 。
 
(4) 固定块标记
 
[1] datalist
从绑定类成员函数GetArcList中获取数组并输出
{dede:datalist}
循环代码
{/dede:datalist}
遍历一个二给维数组，数据源是固定的，只适用用类调用。
等同于
{tag:blockname bind='GetArcList' bindtype='class' rstype='arrayu'}
循环代码
{/tag:blockname}
 
[2] label
从绑定函数中获取字符串值并输出
等同于 {tag:blockname bind='func' bindtype='sub' rstype='string'/}
 
[3] pagelist
 
从绑定类成员函数GetPageList中获取字符串值并输出
等同于 {tag:blockname bind='GetPageList' bindtype='class' rstype='string'/}
 
(5) include 语法
{dede:include file=''/}
{dede:include filename=''/}
 
(6) php 代码块
{dede:php
php 代码
/}
或
{dede:php}
php代码
{/dede:php}
 
(7) if 条件
仅支持 if ，else ，else 直接用{else}表示,但不支持{else if}这样的语法 ，一般建议模板中不要使用太复杂的条件语法，如果确实有需要，可以直接使用 php 语法。
 
{dede:if 条件} a-block  {else} b-block {/dede:if}
 
条件中允许使用 var.name 、 global.name 、 field.name、cfg.name 表示相应的变量。
 
如：
{dede:if field.id>10 }
{/dede:if}
 
(8) 遍历一个 array 数组
 
{dede:array.name}
  {dede:key/} = {dede:value/}
{/dede:array}
 
各种语法的具体编译后的代码，可查看 dede-template-class.php 的 function CompilerOneTag(&$cTag)。
 
块调用示例代码：
1、示例一
查看源码复制到粘贴板打印?
{tag:datalist   timeformat=""}<br />
    <tr><br />
      <td class='col1'><br />
          <div>?<a   href='{tag:field.arcurl/}'>{tag:field.title/}</a></div><br />
          <!--div   class='descriptions'>&nbsp;&nbsp;&nbsp;&nbsp;{tag:field.description   function="CnSubstr(@me,150)"/}...</div--><br />
      </td><br />
      <td   class='col2'>{tag:field.formattime/}</td><br />
      </tr><br />
  {/tag:datalist}
{tag:datalist   timeformat=""}<br />
    <tr><br />
      <td class='col1'><br />
          <div>?<a   href='{tag:field.arcurl/}'>{tag:field.title/}</a></div><br />
          <!--div   class='descriptions'>&nbsp;&nbsp;&nbsp;&nbsp;{tag:field.description   function="CnSubstr(@me,150)"/}...</div--><br />
      </td><br />
      <td   class='col2'>{tag:field.formattime/}</td><br />
      </tr><br />
  {/tag:datalist}
编译后的代码
查看源码复制到粘贴板打印?
<?php 
$atts = array(); 
$atts['tagname'] = 'datalist'; 
$atts['timeformat'] = ''; 
$blockValue = $this->refObj->GetArcList($atts,$this->refObj,$fields);  
foreach( $blockValue as $key=>$fields ) 
{ 
?> 
<tr> 
<td class='col1'> 
<div>?<a href='<?php echo $fields['arcurl']; ?>'><?php echo $fields['title']; ?></a></div> 
<!--div class='descriptions'>&nbsp;&nbsp;&nbsp;&nbsp;<?php echo CnSubstr($fields['description'],150); ?>...</div--> 
</td> 
<td class='col2'><?php echo $fields['formattime']; ?></td> 
</tr> 
<?php 
} 
?> 
  
<?php
$atts = array();
$atts['tagname'] = 'datalist';
$atts['timeformat'] = '';
$blockValue = $this->refObj->GetArcList($atts,$this->refObj,$fields);
foreach( $blockValue as $key=>$fields )
{
?>
<tr>
<td class='col1'>
<div>?<a href='<?php echo $fields['arcurl']; ?>'><?php echo $fields['title']; ?></a></div>
<!--div class='descriptions'>&nbsp;&nbsp;&nbsp;&nbsp;<?php echo CnSubstr($fields['description'],150); ?>...</div-->
</td>
<td class='col2'><?php echo $fields['formattime']; ?></td>
</tr>
<?php
}
?>
 
2、示例二
查看源码复制到粘贴板打印?
{tag:article sort='new'   titlelen='36' row='10'}<br />
     <dd>[{tag:field.typename/}]<a   href="{tag:field.arcurl/}">{tag:field.title   function="CnSubstr(@me,24)"/}</a></dd><br />
  {/tag:article}
{tag:article sort='new'   titlelen='36' row='10'}<br />
     <dd>[{tag:field.typename/}]<a   href="{tag:field.arcurl/}">{tag:field.title   function="CnSubstr(@me,24)"/}</a></dd><br />
  {/tag:article}
 
编译后的代码
查看源码复制到粘贴板打印?
<?php 
$atts = array(); 
$atts['tagname'] = 'article'; 
$atts['sort'] = 'new'; 
$atts['titlelen'] = '36'; 
$atts['row'] = '10'; 
$blockValue = MakePublicTag($atts,$this->refObj,$fields);  
if(is_array($blockValue) && count($blockValue) > 0){ 
foreach( $blockValue as $key=>$fields ) 
{ 
?> 
<dd>[<?php echo $fields['typename']; ?>]<a href="<?php echo $fields['arcurl']; ?>"><?php echo CnSubstr($fields['title'],24); ?></a></dd> 
<?php 
} 
} 
?> 
 
<?php
$atts = array();
$atts['tagname'] = 'article';
$atts['sort'] = 'new';
$atts['titlelen'] = '36';
$atts['row'] = '10';
$blockValue = MakePublicTag($atts,$this->refObj,$fields);
if(is_array($blockValue) && count($blockValue) > 0){
foreach( $blockValue as $key=>$fields )
{
?>
<dd>[<?php echo $fields['typename']; ?>]<a href="<?php echo $fields['arcurl']; ?>"><?php echo CnSubstr($fields['title'],24); ?></a></dd>
<?php
}
}
?>
