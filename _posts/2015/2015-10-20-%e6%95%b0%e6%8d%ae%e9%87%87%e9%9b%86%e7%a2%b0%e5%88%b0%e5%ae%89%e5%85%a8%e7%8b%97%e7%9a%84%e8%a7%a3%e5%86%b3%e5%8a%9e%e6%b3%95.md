---
layout: post
title: 数据采集碰到安全狗的解决办法
date: 2015-10-20 16:48
author: admin
comments: true
categories: []
---
WebShieldDRSessionVerify=

在采集某些网站数据时，由于采集过快，如果网站出现了安全狗提示，可以用一下方法解决。

模拟百度ua
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div></td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="php plain">curl_setopt(</code><code class="php variable">$ch</code><code class="php plain">,CURLOPT_USERAGENT,</code><code class="php string">'Baiduspider+(+http://www.baidu.com/search/spider.htm)'</code><code class="php plain">);</code></div>
</div></td>
</tr>
</tbody>
</table>
清空cookie
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div></td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="php plain">curl_setopt(</code><code class="php variable">$ch</code><code class="php plain">, CURLOPT_COOKIE, </code><code class="php string">''</code><code class="php plain">);</code></div>
</div></td>
</tr>
</tbody>
</table>
模拟请求ip
<table class="syntaxhighlighter  php" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div></td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="php variable">$ip</code> <code class="php plain">= rand(1, 225).</code><code class="php string">'.223.22.'</code><code class="php plain">.rand(0, 225);</code></div>
<div class="line number2 index1 alt1"><code class="php spaces">        </code><code class="php variable">$headers</code><code class="php plain">[</code><code class="php string">'CLIENT-IP'</code><code class="php plain">] = </code><code class="php variable">$ip</code><code class="php plain">;</code></div>
<div class="line number3 index2 alt2"><code class="php spaces">        </code><code class="php variable">$headers</code><code class="php plain">[</code><code class="php string">'X-FORWARDED-FOR'</code><code class="php plain">] = </code><code class="php variable">$ip</code><code class="php plain">;</code></div>
<div class="line number4 index3 alt1"><code class="php spaces">        </code><code class="php variable">$headerArr</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">();</code></div>
<div class="line number5 index4 alt2"><code class="php spaces">        </code><code class="php keyword">foreach</code> <code class="php plain">( </code><code class="php variable">$headers</code> <code class="php keyword">as</code> <code class="php variable">$n</code> <code class="php plain">=&gt; </code><code class="php variable">$v</code> <code class="php plain">)</code></div>
<div class="line number6 index5 alt1"><code class="php spaces">        </code><code class="php plain">{</code></div>
<div class="line number7 index6 alt2"><code class="php spaces">            </code><code class="php variable">$headerArr</code><code class="php plain">[] = </code><code class="php variable">$n</code> <code class="php plain">. </code><code class="php string">':'</code> <code class="php plain">. </code><code class="php variable">$v</code><code class="php plain">;</code></div>
<div class="line number8 index7 alt1"><code class="php spaces">        </code><code class="php plain">}</code></div>
<div class="line number9 index8 alt2"><code class="php spaces">        </code><code class="php plain">curl_setopt(</code><code class="php variable">$ch</code><code class="php plain">, CURLOPT_HTTPHEADER, </code><code class="php variable">$headerArr</code><code class="php plain">);</code></div>
</div></td>
</tr>
</tbody>
</table>
分分钟钟秒杀安全狗防护。
