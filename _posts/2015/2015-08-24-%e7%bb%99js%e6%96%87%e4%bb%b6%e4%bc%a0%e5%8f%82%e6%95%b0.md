---
layout: post
title: 给js文件传参数
date: 2015-08-24 08:51
author: admin
comments: true
categories: []
---
<b>一、利用全局变量</b>
这是最简单的一种方式，比如Google Adsense:
&lt;script type="text/javascript"&gt; google_ad_client ='pub-3741595817388494'; &lt;/script&gt;
&lt;script type="text/javascript" src="http://pagead2. googlesyndication.com/pagead/show_ads.js"&gt;&lt;/script&gt;
复制代码


缺点是引入了全局变量。其中引入文件的方式还有两个变体：
// 变体1：用document.write输出
&lt;script type="text/javascript"&gt;
google_ga_id ='g6u7un8646xx';
document.write(unescape('%3Cscript type="text/javascript" src= "http://www.google-analytics.com/ga.js"%3E%3C/script%3E')); &lt;/script&gt;
// 变体2：用DOM操作append到head里
&lt;script type="text/javascript"&gt;
G_BEACON_ATP ='category=&amp;userid=&amp;channel=112ad_id=';
document.getElementsByTagName('head')[0].appendChild(document. createElement('script')).src='http://taobao.com/atp.js';
&lt;/script&gt; // 注意：上面的代码是根据实际应用虚拟的示范代码
复制代码


注：变体1应用很多，常见写法如下：
&lt;script type="text/javascript"&gt;
// 直接转义即可：
document.write('&lt;script type="text/javascript" src="test.js"&gt;&lt;/script&gt;');
// 或者像Yahoo!首页一样：
document.write('&lt;scr'+'ipt type="text/javascript" src="test.js"&gt;&lt;/scr'+'ipt&gt;');
&lt;/script&gt;
复制代码


<b>二、获取并解析script元素的src</b>
和全部变量相比，我们更希望能像下面这样传入参数：
&lt;script type="text/javascript" src="test.js?a=b&amp;c=d"&gt;&lt;/script&gt;


核心问题是如何获取到src属性。
方法一是给script添加id属性，通过id得到当前script，再用正则从src中取出参数。缺点是HTML 4.01 Specification里，SCRIPT元素没有id属性。这个缺点也算不得是缺点，毕竟尽信标准不如无标准。
方法二是用js的文件名当作钩子，js代码里通过document.getElementsByTagName('script')后，正则匹配出当前js文件。这个方法很正统，但要求文件名唯一。缺点是代码多，不精炼，对性能也稍有影响。
方法三是在方法一的基础上，干脆再添加一个自定义属性data：
&lt;script id="testScript" type="text/javascript" src="test.js" data="a=b&amp;c=d"&gt;&lt;/script&gt;
test.js文件里，通过下面这行得到传入的参数：
var scriptArgs = document.getElementById('testScript').getAttribute('data');


方法四是利用js的顺序执行机制（js文件的加载可以是同步或异步方式，但执行时，一定是按照在文档流中的顺序来执行的）。当某个js文件执行时，一定是“已加载”的js文件中的最后一个：
var scripts = document.getElementsByTagName('script'); var currentScript = scripts[scripts.length - 1];


方法四比方法二更灵巧天才。
从代码的精简和性能上讲，方法三 &gt; 方法 一 &gt; 方法四 &gt; 方法二
小结：如果你很在意标准，推荐方法四；如果和我一样觉得没必要完全遵守标准，推荐方法三。
写了个测试程序
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;script src="a2.js"&gt;
&lt;/script&gt;
&lt;script src="a2.js"&gt;
&lt;/script&gt;
&lt;script src="a2.js"&gt;
&lt;/script&gt;
&lt;/html&gt;
复制代码
a2.js
var scripts = document.getElementsByTagName('script');
var currentScript = scripts.length;
alert(currentScript);
复制代码
分别打印出
1 2 3

<b>三、灵感方案</b>
如果你和我一样是John Resig的忠实fans，或许还记得去年8月份讨论得很火爆的《<a href="http://ejohn.org/blog/degrading-script-tags/">Degrading Script Tags</a>》。John Resig给我们开启了一扇想象的门，对于本文的问题来说，还可以用以下“邪门歪道”来实现：
&lt;script type="text/javascript" src="test.js"&gt; TB.SomeApp.scriptArgs ='a=b&amp;c=d'; &lt;/script&gt;
在test.js文件里：
TB = {}; TB.SomeApp = {};
var scripts = document.getElementsByTagName("script");
eval(scripts[ scripts.length - 1 ].innerHTML);
复制代码
这样就将参数存储到了TB.SomeApp.scriptArgs变量里。
当参数不多时，甚至可以这样：
&lt;script type="text/javascript" src="test.js"&gt;a=b&amp;c=d&lt;/script&gt;
js文件里：
var scripts = document.getElementsByTagName("script");
var scriptArgs = scripts[ scripts.length - 1 ].innerHTML.replace(/[s]/g, '');
复制代码
想象是无止境的，还可以利用onload:
&lt;script type="text/javascript" src="test.js" onload="TB.SomeFun('a=b&amp;c=d')"&gt;&lt;/script&gt;
js文件里定义好函数即可：
TB = {};

TB.SomeFun = function(arg) { //code
};
复制代码


上面的代码在非ie浏览器下，都能正确运行。针对笨笨的ie，还得加几行代码：
if(window.ActiveXObject) {
var scripts = document.getElementsByTagName('script');

eval(scripts[scripts.length - 1].getAttribute('onload'));

}
