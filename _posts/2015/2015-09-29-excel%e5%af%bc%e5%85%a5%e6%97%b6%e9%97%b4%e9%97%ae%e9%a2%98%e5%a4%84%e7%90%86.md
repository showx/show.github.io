---
layout: post
title: excel导入时间问题处理
date: 2015-09-29 09:34
author: admin
comments: true
categories: []
---
excel导入时间问题处理：

public function excelTime($date, $time=false){
if(is_numeric($date)){
$jd = gregoriantojd(1, 1, 1970);
$gregorian = jdtogregorian($jd+intval($date)-25569);
$date = explode('/',$gregorian);
$date_str = str_pad($date[2],4,'0', STR_PAD_LEFT)
."-".str_pad($date[0],2,'0', STR_PAD_LEFT)
."-".str_pad($date[1],2,'0', STR_PAD_LEFT)
.($time?" 00:00:00":'');
return $date_str;
}
return $date;
}
function excel_D2DMY($days) {
if ($days &lt;1) return "";
if(is_numeric($days))
{
if ($days == 60) {
return array('day'=&gt;29,'month'=&gt;2,'year'=&gt;1900);
} else {
if ($days &lt; 60) {
// Because of the 29-02-1900 bug, any serial date
// under 60 is one off... Compensate.
++$days;
}
// Modified Julian to DMY calculation with an addition of 2415019
$l = $days + 68569 + 2415019;
$n = floor(( 4 * $l ) / 146097);
$l = $l - floor(( 146097 * $n + 3 ) / 4);
$i = floor(( 4000 * ( $l + 1 ) ) / 1461001);
$l = $l - floor(( 1461 * $i ) / 4) + 31;
$j = floor(( 80 * $l ) / 2447);
$nDay = $l - floor(( 2447 * $j ) / 80);
$l = floor($j / 11);
$nMonth = $j + 2 - ( 12 * $l );
$nYear = 100 * ( $n - 49 ) + $i + $l;
// $ret = array('day'=&gt;$nDay,'month'=&gt;$nMonth,'year'=&gt;$nYear);

if(strlen($nMonth)==1)
{
$nMonth = "0".$nMonth;
}
if(strlen($nDay)==1)
{
$nDay = "0".$nDay;
}

$ret = $nYear.$nMonth.$nDay;
return $ret;
}
}
return $days;
}
function jd_to_greg($julian) {

if(is_numeric($julian))
{
$julian = $julian - 1721119;
$calc1 = 4 * $julian - 1;
$year = floor($calc1 / 146097);
$julian = floor($calc1 - 146097 * $year);
$day = floor($julian / 4);
$calc2 = 4 * $day + 3;
$julian = floor($calc2 / 1461);
$day = $calc2 - 1461 * $julian;
$day = floor(($day + 4) / 4);
$calc3 = 5 * $day - 3;
$month = floor($calc3 / 153);
$day = $calc3 - 153 * $month;
$day = floor(($day + 5) / 5);
$year = 100 * $year + $julian;

if ($month &lt; 10) {
$month = $month + 3;
}
else {
$month = $month - 9;
$year = $year + 1;
}
if ($day &lt; 10) {
$day = "0".$day;
}
if ($month &lt; 10) {
$month = "0".$month;
}
// return $day."/".$month."/".$year;
return $year.$month.$day;
}else{
return $julian;
}
}
