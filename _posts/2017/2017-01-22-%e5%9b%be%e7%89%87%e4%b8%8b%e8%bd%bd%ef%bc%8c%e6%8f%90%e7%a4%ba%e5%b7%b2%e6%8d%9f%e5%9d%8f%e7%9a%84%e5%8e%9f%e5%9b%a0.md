---
layout: post
title: 图片下载，提示已损坏的原因
date: 2017-01-22 07:03
author: admin
comments: true
categories: [Uncategorized]
---
排查了一下，主要是php文件是带有bom.. bom作用是告诉编辑器用的是什么编码。。

一开始以为是服务器开始了zlib的原因。

if(ini_get('zlib.output_compression'))
{
ini_set('zlib.output_compression', 'Off');
}

加上之后并不生效，再次查找，打开图片源码多了ï»¿,十六进制\xEF\xBB\xBF,把它去掉就显示出来了。  很多时候bom的问题在beyond compare都可以见到，

附上解决方案：

class b{

/**
* 去掉文件中的 bom头
* @var 0.1
* @author Chenwp
*/
public function clearbom($contents){
//UTF8 去掉文本中的 bom头
$BOM = chr(239).chr(187).chr(191);
return str_replace($BOM,'',$contents);
}
/**
* 去掉文件中的bom头
* @param object $fileName Description
* @return object Description
*/
public function clearfilebom(){

$fileName = __FILE__;
$c = file_get_contents($fileName);
$c = self::clearbom($c);
file_put_contents($fileName,$c);
}

}

替换去掉当前页面的bom头部。
