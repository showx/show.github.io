---
layout: post
title: php7之memcache扩展
date: 2017-09-09 02:51
author: admin
comments: true
categories: [Uncategorized]
---
安装 memcached 扩展
尝试用 PECL 安装，memcached 在 PECL 上的地址是：
https://pecl.php.net/package/memcached
[root@lnmp lnmp.cn]# pecl install memcached
pecl/memcached requires PHP (version >= 5.2.0, version <= 6.0.0, excluded versions: 6.0.0), installed version is 7.0.8
No valid packages found
install failed
[root@localhost vagrant]#
提示很明显，PECL 上的 memcached 扩展只支持 PHP 5.2 以上，6.00 以下的版本。还未更新到 PHP7。不过还好的是在 PECL 的 memcached 页面可以找到他们在 github 上的链接：
https://github.com/php-memcached-dev/php-memcached
这上面的代码已经有可以支持到 PHP7 的分支。这里将源码统一下载到 php 源码的 ext 目录：
[root@lnmp lnmp.cn]# cd /usr/local/src/php-7.0.8/ext/
[root@lnmp ext]# git clone https://github.com/php-memcached-dev/php-memcached memcached
[root@lnmp ext]# cd memcached/
checkout 到 php7 分支：
[root@lnmp memcached]# git checkout php7
Branch php7 set up to track remote branch php7 from origin.
Switched to a new branch 'php7'
[root@lnmp memcached]#
用 phpize 安装，我的 PHP 是安装在 /usr/local/php7 下
[root@lnmp memcached]# /usr/local/php7/bin/phpize
[root@lnmp memcached]# ./configure --with-php-config=/usr/local/php7/bin/php-config
接着 make 和 make install
[root@lnmp memcached]# make
[root@lnmp memcached]# make install
Installing shared extensions:     /usr/local/php7/lib/php/extensions/no-debug-non-zts-20151012/
[root@lnmp memcached]#
可以看到 memcached 已经安装完成，并且扩展文件已经放到提示的目录：
[root@lnmp memcached]# ls /usr/local/php7/lib/php/extensions/no-debug-non-zts-20151012/
memcached.so  opcache.a  opcache.so
[root@lnmp memcached]#
最后一步在 php.ini 中引入 memcached.so
[root@lnmp memcached]# vim /usr/local/php7/lib/php.ini
加入：
extension=memcached.so
记得 reload 一下 php-fpm 才能生效
[root@lnmp memcached]# systemctl reload php-fpm
打开 phpinfo 页面，已经已经看到 memcached 扩展成功安装了。
php7 memcached

安装 memcache 扩展
同样尝试用 PECL 来安装：
[root@lnmp memcached]# pecl install memcache
但同样失败
/tmp/pear/temp/memcache/memcache.c:40:40: fatal error: ext/standard/php_smart_str.h: No such file or directory
 #include "ext/standard/php_smart_str.h"
                                                                                ^
compilation terminated.
make: *** [memcache.lo] Error 1
ERROR: `make' failed
貌似原因也是 PECL 还不支持在 PHP7 下安装 memcache 扩展,
https://pecl.php.net/package/memcache
2013年以来为更新过。此路不通只能另想办法，同样是到 github 上碰碰运气。搜索 pecl memcache
https://github.com/search?utf8=%E2%9C%93&q=pecl+memcache&type=Repositories&ref=searchresults
其中第一个(https://github.com/websupport-sk/pecl-memcache)就是想要的，并且代码已经支持到 PHP7，立即下载代码编译：
[root@lnmp memcached]# cd ../
[root@lnmp ext]# git clone https://github.com/websupport-sk/pecl-memcache memcache
[root@lnmp ext]# cd memcache
用 phpize 安装，步骤和 memcached 一模一样
[root@lnmp memcache]# /usr/local/php7/bin/phpize
[root@lnmp memcache]# ./configure --with-php-config=/usr/local/php7/bin/php-config
[root@lnmp memcache]# make
[root@lnmp memcache]# make install
Installing shared extensions:     /usr/local/php7/lib/php/extensions/no-debug-non-zts-20151012/
[root@lnmp memcache]#
类似 memcached , 将 memcache.so 在 php.ini 中引入
[root@lnmp memcache]# vim /usr/local/php7/lib/php.ini
加入：
extension=memcache.so
最后 reload php-fpm
[root@lnmp memcache]# systemctl reload php-fpm
大功告成，可以在 phpinfo 页面看到 memcahce 和 memchaced 都已经成功安装
php7 memcache
安装 Memcached 内存缓存服务器
Centos 下可以用 yum 进行安装
[root@lnmp memcache]# yum install memcached
再启动 Memcached 就可以测试 PHP 扩展了
[root@lnmp memcache]# systemctl start memcached
默认端口是 11211
