---
layout: post
title: ubuntu apt-get update 失败解决。
date: 2014-11-12 10:52
author: admin
comments: true
categories: []
---
当运行apt-get update后出现如下错误时：
E: Some index files failed to download, they have been ignored, or old ones used instead.
可以将目录下/var/lib/apt/lists/partial/所有的文件清掉，再次运行apt-get update即可！自带源在大陆不好。

出现以下错误：
[plain] view plaincopy在CODE上查看代码片派生到我的代码片
/etc/apt$ sudo apt-get update  
Err http://security.ubuntu.com precise-security InRelease  
    
Err http://security.ubuntu.com precise-security Release.gpg  
  Temporary failure resolving 'security.ubuntu.com'  
Err http://cn.archive.ubuntu.com precise InRelease  
    
Err http://cn.archive.ubuntu.com precise-updates InRelease  
    
Err http://cn.archive.ubuntu.com precise-backports InRelease  
    
Err http://cn.archive.ubuntu.com precise Release.gpg  
  Temporary failure resolving 'cn.archive.ubuntu.com'  
Err http://cn.archive.ubuntu.com precise-updates Release.gpg  
  Temporary failure resolving 'cn.archive.ubuntu.com'  
Err http://cn.archive.ubuntu.com precise-backports Release.gpg  
  Temporary failure resolving 'cn.archive.ubuntu.com'  
Reading package lists... Done  
W: Failed to fetch http://cn.archive.ubuntu.com/ubuntu/dists/precise/InRelease    
  
W: Failed to fetch http://cn.archive.ubuntu.com/ubuntu/dists/precise-updates/InRelease    
  
W: Failed to fetch http://cn.archive.ubuntu.com/ubuntu/dists/precise-backports/InRelease    
  
W: Failed to fetch http://security.ubuntu.com/ubuntu/dists/precise-security/InRelease    
  
W: Failed to fetch http://security.ubuntu.com/ubuntu/dists/precise-security/Release.gpg  Temporary failure resolving 'security.ubuntu.com'  
  
W: Failed to fetch http://cn.archive.ubuntu.com/ubuntu/dists/precise/Release.gpg  Temporary failure resolving 'cn.archive.ubuntu.com'  
  
W: Failed to fetch http://cn.archive.ubuntu.com/ubuntu/dists/precise-updates/Release.gpg  Temporary failure resolving 'cn.archive.ubuntu.com'  
  
W: Failed to fetch http://cn.archive.ubuntu.com/ubuntu/dists/precise-backports/Release.gpg  Temporary failure resolving 'cn.archive.ubuntu.com'  
  
W: Some index files failed to download. They have been ignored, or old ones used instead.  
xinju@xinjuOffice:/etc/apt$ cd ../network  

阿里源:
[plain] view plaincopy在CODE上查看代码片派生到我的代码片
deb http://mirrors.aliyun.com/ubuntu/ raring main restricted universe multiverse  
deb http://mirrors.aliyun.com/ubuntu/ raring-security main restricted universe multiverse  
deb http://mirrors.aliyun.com/ubuntu/ raring-updates main restricted universe multiverse  
deb http://mirrors.aliyun.com/ubuntu/ raring-proposed main restricted universe multiverse  
deb http://mirrors.aliyun.com/ubuntu/ raring-backports main restricted universe multiverse  
deb-src http://mirrors.aliyun.com/ubuntu/ raring main restricted universe multiverse  
deb-src http://mirrors.aliyun.com/ubuntu/ raring-security main restricted universe multiverse  
deb-src http://mirrors.aliyun.com/ubuntu/ raring-updates main restricted universe multiverse  
deb-src http://mirrors.aliyun.com/ubuntu/ raring-proposed main restricted universe multiverse  
deb-src http://mirrors.aliyun.com/ubuntu/ raring-backports main restricted universe multiverse  

修改ip:
[plain] view plaincopy在CODE上查看代码片派生到我的代码片
# This file describes the network interfaces available on your system  
# and how to activate them. For more information, see interfaces(5).  
  
# The loopback network interface  
auto lo  
iface lo inet loopback  
  
# The primary network interfacea  
auto eth0  
iface eth0 inet static  
address 192.168.2.170  
netmask 255.255.255.0  
broadcast 192.168.2.255  
gateway 192.168.2.1  
dns-nameservers 192.168.2.1  


修改dns:
1,重启生效：

sudo vi /etc/resolvconf/resolv.conf.d/base（这个文件默认是空的）
在里面插入：
nameserver 8.8.8.8
nameserver 8.8.4.4
如果有多个DNS就一行一个
修改好保存，然后执行
sudo resolvconf -u
再看/etc/resolv.conf，最下面就多了2行：
cat /etc/resolv.conf
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 8.8.8.8
nameserver 8.8.4.4
可以看到我们的设置已经加上了，然后再ping一个域名，当时就可以解析了，无需重启。

2，重启失效：

配置文件地址 /etc/resolv.conf

使用编辑器打开

改为如下内容：
search localdomain
nameserver 202.96.128.86 希望修改成的DNS
nameserver 202.96.128.166 备用DNS

重启网络：sudo /etc/init.d/networking restart。即可

