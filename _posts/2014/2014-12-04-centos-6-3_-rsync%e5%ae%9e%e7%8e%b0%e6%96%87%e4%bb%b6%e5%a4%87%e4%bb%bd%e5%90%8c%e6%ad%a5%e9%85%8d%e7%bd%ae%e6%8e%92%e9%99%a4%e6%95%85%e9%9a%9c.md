---
layout: post
title: CentOS 6.3_ rsync实现文件备份同步配置排除故障
date: 2014-12-04 13:14
author: admin
comments: true
categories: []
---
排除故障 
***************************
1.@ERROR: auth failed on module xxxxx
    rsync: connection unexpectedly closed (90 bytes read so far)
    rsync error: error in rsync protocol data stream (code 12) at io.c(150)
    这是因为密码设错了, 无法登入成功, 请检查一下 rsyncd.scrt 中的密码, 二端是否一致? 
2.password file must not be other-accessible 
    continuing without password file 
    Password:
    这表示 rsyncd.scrt 的档案权限属性不对, 应设为 600。
3.@ERROR: chroot failed
    rsync: connection unexpectedly closed (75 bytes read so far)
    rsync error: error in rsync protocol data stream (code 12) at io.c(150) 　　
    这通常是您的 rsyncd.conf 中的 path 路径所设的那个目录并不存在所致.请先用 mkdir开设好要备份目录
4.@ERROR: access denied to www from unknown (192.168.1.123)
    rsync: connection unexpectedly closed (0 bytes received so far) [receiver]
    rsync error: error in rsync protocol data stream (code 12) at io.c(359)
    最后原因终于找到了。因为有两个网段都需要同步该文件夹内容，但没有在hosts allow 后面添加另一个IP段
    hosts allow = 192.168.1.0/24
    改为
    hosts allow = 192.168.1.0/24 192.168.2.0/24
    重新启动rsync服务，问题解决 
5.rsync: failed to connect to 172.21.50.8: No route to host (113)
    rsync error: error in socket IO (code 10) at clientserver.c(104) [receiver=2.6.9]
    对方没开机、防火墙阻挡、通过的网络上有防火墙阻挡，都有可能。关闭防火墙，其实就是把tcp udp 的873端口打开
    启动服务：rsync --daemon --config=/etc/rsyncd.conf
6.@ERROR: auth failed on module backup
    rsync error: error starting client-server protocol (code 5) at main.c(1506) [Receiver=3.0.7]
    client端没有设置/etc/rsync.pas这个文件，而在使用rsync命令的时候，加了这个参数--password-file=/etc/rsync.scrt 
7.rsync: recv_generator: mkdir "/teacherclubBackup/rsync……" failed: No space left on device (28)
    *** Skipping any contents from this failed directory ***
    磁盘空间满了 
8.rsync: opendir "/kexue" (in dtsChannel) failed: Permission denied (13)
    同步目录的权限设置不对，改为755 
9.rsync: read error: Connection reset by peer (104)
    rsync error: error in rsync protocol data stream (code 12) at io.c(759) [receiver=3.0.5]
    未启动xinetd守护进程
    [root@CC02 /]# service xinetd start
10.rsync: unable to open configuration file "/etc/rsyncd.conf": No such file or directory
    xnetid查找的配置文件位置默认是/etc下，在/etc下找不到rsyncd.conf文件
11.rsync: failed to connect to 203.100.192.66: Connection timed out (110)
    rsync error: error in socket IO (code 10) at clientserver.c(124) [receiver=3.0.5]
    连接服务器超时，检查服务器的端口netstat –tunlp，远程telnet测试
12.[root@client cron.daily.rsync]# sh root.sh  
    ERROR: password file must not be other-accessible
    rsync error: syntax or usage error (code 1) at authenticate.c(175) [Receiver=3.0.9]
    创建密码文件，root用户用的是 rsyncroot.password，权限是600
13.如何通过ssh进行rsync，而且无须输入密码？
　　可以通过以下几个步骤
　　1. 通过ssh-keygen在server A上建立SSH keys，不要指定密码，你会在~/.ssh下看到identity和identity.pub文件 
　　2. 在server B上的home目录建立子目录.ssh
　　3. 将A的identity.pub拷贝到server B上
　　4. 将identity.pub加到~[user b]/.ssh/authorized_keys
　　5. 于是server A上的A用户，可通过下面命令以用户B ssh到server B上了。e.g. ssh -l userB serverB。这样就使server A上的用户A就可以ssh以用户B的身份无需密码登陆到server B上了。
14.如何通过在不危害安全的情况下通过防火墙使用rsync?
　　解答如下：
　  这通常有两种情况，一种是服务器在防火墙内，一种是服务器在防火墙外。无论哪种情况，通常还是使用ssh，这时最好新建一个备份用户，并且配置sshd 仅允许这个用户通过RSA认证方式进入。如果服务器在防火墙内，则最好限定客户端的IP地址，拒绝其它所有连接。如果客户机在防火墙内，则可以简单允许防 火墙打开TCP端口22的ssh外发连接就ok了。
15.我能将更改过或者删除的文件也备份上来吗？
　　当然可以。你可以使用如：rsync -other -options -backupdir = ./backup-2000-2-13  ...这样的命令来实现。这样如果源文件:/path/to/some/file.c改变了，那么旧的文件就会被移到./backup- 2000-2-13/path/to/some/file.c，这里这个目录需要自己手工建立起来
16.我需要在防火墙上开放哪些端口以适应rsync？
　　视情况而定。rsync可以直接通过873端口的tcp连接传文件，也可以通过22端口的ssh来进行文件传递，但你也可以通过下列命令改变它的端口：
　　rsync --port 8730 otherhost::
　　或者
　　rsync -e 'ssh -p 2002' otherhost:
17.我如何通过rsync只复制目录结构，忽略掉文件呢？　
　　rsync -av --include '*/' --exclude '*' source-dir dest-dir
18.为什么我总会出现"Read-only file system"的错误呢？
　　看看是否忘了设"read only = no"了
