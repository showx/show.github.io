---
layout: post
title: SVN 用户管理
date: 2014-09-15 15:09
author: admin
comments: true
categories: []
---
目前我们使用svn管理用户时，主要从库，组，项目等方面来管理。
首先，我们要有一个svn的管理员用户，我们是admin，对应在linux上也有一个svnadmin的操作系统用户。
下面区分说明这两个用户，svnadmin是跟资源库存储相关的。因为要跟apache的访问对应，所以要修改apache中的httpd.conf文件中的
user  svnadmin #这是指让apache以svnadmin这个用户来访问svn的系统操作系统上的路径和文件
group svn        #svnadmin所在的linux group
 
以root用户做的如下操作和管理：
创建授予svnadmin管理的svn文件管理路径：
$mkdir /opt/svn
$chown -R svnadmin:svn /opt/svn
以svnadmin用户登陆：
$su - svnadmin
#创建一个资源库路径
#mkdir /opt/svn/repository
#通过svn来创建资源库
#/usr/local/subversion/bin/svnadmin create/opt/svn/repository  #/usr/local/subversion 是我们安装svn的路径
到/opt/svn/repository路径下查看，是否有相应的一堆文件和文件夹产生？没有，就是没成功，到网上查原因吧
一般情况下，创建资源库就够了，应该是在资源库中管理项目，而不是一个项目一个资源库。当然，svn完全允许你这样来管理。
这里需要特别说明的是，刚才我们是创建了一个repository资源库。
有了资源库之后，我们就可以通过TortoiseSVN（小乌龟）客户端在windows上以svn管理员（注意，不是linux用户svnadmin）用户，上传一个项目到repository库中（为了下面描述，这里称这个项目为test）。
 
用户管理：
用户管理分为组管理和用户管理。
Svn中的用户验证也是分为两种方式：密码验证和访问权限验证。
根据我们在apachehttpd.conf中的配置（密码验证文件，由AuthUserFile属性指定的文件，定为htpasswd文件；及AuthzSVNAccessFile属性指定的访问权限文件，定为authz.conf文件），来配置、增加用户和管理用户访问权限。
增加一个用户及其密码：
/usr/local/apache2/bin/htpasswd [–c]/opt/svn/htpasswd admin (ENTER)
说明这里-c是表示如果/opt/svn/htpasswd指定的文件不存在，则直接创建。否则可以不加-c.
回车之后，会要求输入密码。通过这种方式即可实现用户的添加，可以
more /opt/svn/htpasswd 查看一下里面的用户及密码，不过这密码是经过加密的，如果想用md5加密，也可以加上 –m ,如。/usr/local/apache2/bin/htpasswd [–c]–m /opt/svn/htpasswd admin (ENTER)。
 
访问权限配置：
vi /opt/svn/authz.conf
[groups]
admin = admin
test  = user1,user2
 
[/]
@admin = rw
 
[repository:/test]
@test = rw
 
说明：
groups是指用户组。上面的配置说明存在两个组：admin和test，其中admin组中只有一个用户admin，test中有两个用户user1,user2
[/]
@admin = rw
这段配置表示admin组中的成员对所有的资源库的根目录都有读写权限，如我们已经创建了一个repository库，那么admin组中的成员admin就可以读写它的里面的所有内容，即所有项目。
[repository:/test]
@test = rw
表示test组中的成员仅对repository库中的test项目有访问权限。


=======================


前言
SVN服务器有2种运行方式：独立服务器和借助apache。2种方式各有利弊，独立SVN服务器不结合Apache安装使用，连接独立SVN服务器也不用HTTP协议。这是比较快捷的SVN服务器配置方法。本次安装时使用的是独立用品方式。

SVN存储版本数据也有2种方式：BDB和FSFS。因为BDB方式在服务器中断时，有可能锁住数据所以还是FSFS方式更安全一点，我安装时也使用的是FSFS方式。
一 下载工具

1. subversion-1.6.17.tar.gz

2. subversion-deps-1.6.17.tar.gz

这两个包可以直接到CSDN去下载，版本要一样，都是必须下载的，否则单独下载第一个包编译时就会提示缺少模块。这两个包下载解压后会解压到同一个目录下，不需要特别指定。

 
二 解压安装

1. 解压两个包：

在此之前，我已经创建了一个用户svnadmin专门用来安装管理svn的，就解压在/home/svnadmin/目录下

tar -xzvf  subversion-1.6.17.tar.gz

tar -xzvf  subversion-deps-1.6.17.tar.gz

2. 编译安装

./configure --prefix=/home/svnadmin/subversion  --without-berkeley-db

//prefix指定安装的目录，without-berkeley-db表明不使用berkeley数据库

//在这一步有可能不成功，是因为有一些依赖的软件没装，具体见下面“遇到的问题”

make

make install

//也许要sudo，看情况

3. 查看是否安装成功

/home/svnadmin/subversion/bin/svnserve --version

//如果出现SVN的版本则证明安装成功

三 添加环境变量

可以在/etc/profile中添加，这是全局的。其实最好是专门添加一个svnadmin用户，在~/.bashrc中添加即可：

exprot PATH=$PATH:/home/svnadmin/subversion/bin

四 建立仓库

1. 创建目录

mkdir  -p  /home/svnadmin/svndata/repos1

加上参数P，是如果没有父目录则自动创建

注意： /home/svnadmin/svndata在这里将是所有仓库的根目录，repos1是其中的一个仓库。

2. 创建仓库

svnadmin create /svndata/repos1

这里使用SVN将repos1建立为仓库。则在repos1文件夹里会生成一系列对于repos1仓库相应的配置文件

五 配置仓库

1. 查看创建仓库后的文件

进入/svndata/repos1/conf，会发现有几个配置文件，如下图



2. 修改svnserve.conf

vi svnserve.conf

打开这个配置文件，可以看到很多配置项已经注释掉了，只需要按下面这几项修改就可以了

[general]

anon-access = none

auth-access = write

password-db = passwd

authz-db=authz

3. 目录控制文件authz （or叫权限控制文件）

vi authz

默认是没有配置的，要参照下面示例来配置

[groups]

admin = svnadmin

[repos1:/]

@admin = rw

svnadmin = rw

上面的配置权限控制文件的配置格式如下：

[groups]

<用户组名> = <用户1>,<用户2>, ……

[<版本库>:/项目/目录]

@<用户组名> = <权限>

<用户名> = <权限>

其中，方框号内部分可以有多种写法:

/，表示根目录及以下。根目录是svnserve启动时指定的，我们指定为/home/svnadmin/svndata。这样，/就是表示对全部版本库设置权限。

repos1:/，表示对版本库1设置权限

repos2:/occi，表示对版本库2中的occi项目设置权限

repos2:/occi/aaa,，表示对版本库2中的occi项目的aaa目录设置权限

权限主体可以是用户组、用户或*，用户组在前面加@，*表示全部用户。权限可以是w、r、wr和空，空表示没有任何权限。

4. 修改用户密码文件passwd

vi passwd

默认也是没有配置任何用户的，可按下面配置示例配置

[users]

svnadmin = 123456

用户密码的配置格式：

[users]

<用户1> = <密码1>

<用户2> = <密码2>

注意：这里的配置文件，除了注释外每行都必须顶行，否则又会报错了。

五 启动SVN

svnserve -d -r /home/svnadmin/svndata

-d表示在后台运行，-r表示……

注意：这里是/home/svnadmin/svndata，并非/home/svnadmin/svndata/repos1。这是SVN使所有仓库根目录都生效的命令，并非某个仓库。这里必须注意。

六 开启SVN的端口，默认是3690

在测试的时候，在本机可以使用svn，但是到了其他主机(在同一个局域网)就不行了，

错误信息提示：svn: 无法连接主机“192.168.6.74”: 没有到主机的路由

这就是因为防火墙的问题，要保证服务器和客户端都没有屏蔽这个端口

七 基本测试

1. checkout

svn co svn://192.168.6.74/repos1

checkout的时候，会要求输入用户名密码，只有配置了的用户才能验证通过

2. 更新

svn up

3. 提交

svn ci -m 'add file'

4. 查看信息

svn info

5. 增/删

svn add file / svn del fiel

八 遇到的问题

刚开始我在虚拟机上的ubuntu上面安装时，出现了如下的错误，附上解决方法。后来我在red hat服务器上面安装的时候就不会出现如下错误，可以是服务器版的linux已经安装了这些软件。环境不同，可能还会出现其他的问题，没有遇到而已。

1. OpenSSL

configure配置SVN时可能提示如下错误信息：

configure: error: We require OpenSSL; try --with-openssl

解决方法：

错误提示需要安装openssl，所以我就安装了一个openssl，安装方法如下：

下载openssl：http://www.openssl.org/source/openssl-1.0.0a.tar.gz

cd /usr/local

tar -zxvf openssl-1.0.0a.tar.gz

cd openssl-1.0.0a

./config

./config -t

make depend

make

make test

make instal

安装之后会在/usr/local下生成一个ssl目录，配置SVN时加上openssl路径

./configure --prefix=/home/svnadmin/subversion --without-berkeley-db --with-openssl=/usr/local/ssl 

2. zlib

configure配置SVN时可能提示如下错误信息：

configure: error: subversion requires zlib

错误提示需要安装zlib

下载zlb：http://zlib.net/

cd /usr/local

tar -xvzf zlib-1.2.5.tar.gz

cd zlib-1.2.5

./configure

make

make install

3. expat

 configure配置SVN时可能提示如下错误信息：

configure: error: no XML parser was found: expat or libxml 2.x required

错误提示需要安装expat

下载expat ：http://sourceforge.net/project/showfiles.php?group_id=10127

cd /usr/local

tar -xvzf expat2.tar.gz

cd expat2

./configure

make

make install
