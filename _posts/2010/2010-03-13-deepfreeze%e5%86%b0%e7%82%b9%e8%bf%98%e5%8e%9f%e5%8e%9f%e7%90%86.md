---
layout: post
title: DeepFreeze(冰点)还原原理
date: 2010-03-13 16:20
author: admin
comments: true
categories: []
---
声明：此文章为转载

DeepFreeze冰点原理
冰点的还原是获取南桥芯片的I0控制权，说白了就是控制硬盘的INT13中断，几乎所有的还原软件都是靠这个实现的，当装入正确的驱动后,冰点就可以正确的拿到I0控制器的控制权,然后使用自己的硬盘驱动程序替换原本的驱动,就达到了任何关于硬盘的写入都要经过他的控制,这样就可以轻易的达到还原目的,同样,双系统或者GHOST恢复的话,正确装上了冰点的系统才会有还原功能,如果没有装的话,当然就没有啦.所以GHOST下可以无限制的添加文件,而windows下添加文件就被还原了.
　　冰点是随着windows的启动才启动的,windows启动加载驱动的时候冰点就通过某种方式触发启动了,由于冰点有I0控制器的控制权,所以,他可以把任何写入硬盘的东西放到任何地方,不知道大家有没看过temp(windows临时文件夹)下有个DF5.TMP对不?具体的文件名我记不到蛮清楚了,而且,我现在不在我的网吧里,这家网吧把C盘屏蔽了<a href="mailto:!@#$%$">mailto:!@#$%$</a>所以不能提供具体的名称了,大家可以自己看看
　　补充，冰点的转储一般是随着windows的临时文件夹的，所以，系统做完以后一定要把windows临时文件夹转移到一个比较空闲的盘里，不然，就会出现丢失文件的情况的（下载大文件后丢失文件就是这样引起的），因为，DF把所有写入的文件都放在那里面，虽然表面上看你丢在了别处，但是存储位置实际上还是在临时文件夹里，只是windows显示给你的路径给你了误导，它在硬盘上的实际位置应该是在临时文件夹下面。
DOS下面不可能操作冰点啊，就算是使用NTFSDOS修改了它，就可能启动不好了，而且DOS下也不能安装冰点吧另外，DF设计用于NTFS的时候就认为NTFS不被DOS支持，所以，没有提供DOS下的支持，甚至在FAT32的win98 的DOS下都不提供支持，DF的设计是面向windows的
最好把系统的文件格式改为NTFS，但是NTFS确实也存在丢失文件的，我曾经遇到过，但是，NTFS丢失文件绝大部分是与硬件相关的，我遇上问题的那次是键盘的接口接触不好，更换键盘，文件丢失现象就解决了，
windows 2000/XP/2003下有个NTDETECT.COM文件,这个文件是在windows启动的时候负责读取硬件信息的程序,ntldr在每次启动的时候第一个加载的就是它,然后它会给分别读取每个硬件的信息,决定ntldr需要加载的驱动程序,因为这个程序不是windows下的程序,设计的也很简便,所以,硬件如果有某些小问题,造成没有发现某些必须的硬件,某些驱动便不能加载,然后提示文件丢失(有时候BIOS能通过,能报错哪些硬件损坏,但windows在启动的时候没有告诉你什么硬件坏了吧?要么启动失败,要么启动成功以后告诉你什么什么坏了),我们有时候遇到这样的事情,机器不能启动了,但,放几天又好了,或者放几天又坏了,就存在某些元件受潮?受热?很多小小小的不能小的问题集中起来就要出大问题的.我的说法很偏激,是一种比较的钻牛角尖的说法的,如果你每台机器都是那样的话那就不存在硬件上的问题了,但在我看来,丢失文件的几率真的很低啊(NTFS).所以,NTFS下丢文件,基本上是硬件引起的,不知道哪位兄弟能给出点意见啊.又或者我分析的不对了.
NTDETECT.COM这个文件在启动的时候会往注册表里的一个键下面添加硬件环境信息，具体我不清楚啦，以此来决定加载什么驱动的，没有检测什么哪个硬件就不会加载相应的驱动，ntldr在加载系统文件的时候就有可能发生错误，说什么什么文件丢失，其实，那个文件还是存在的，只是没有按NTDETECT.COM给出的列表加载进去而已。
看了上贴，想必大家更清楚了点冰点了吧，
我看这上面对于冰点的问题，除了不能使用就是安装出错吧，
errer #00100040
errer #00000000
这些都和你的什么SP4啊，都没有关系，关键在于你没有使用一个工具给你的GHOST系统打包，就是系统安装盘带的封装工具，希望大家在做好系统，快刻盘的时候先把系统封装一次，然后重起的时候直接在GHOST服务器上获取母盘（不要让系统启动，不然封装就白做了）。然后是驱动程序的安装顺序和版本问题，原则上，你必须使用安装盘上的驱动程序，我看相当一部分人是用的通用驱动吧，厂商生产的时候会根据自己的需要改变电气结构（偷工减料？节约成本？），如果加入了很多的新鲜功能，那就需要自己改写驱动程序了，所以，这时候，就必须得使用厂商给你的驱动了，我也建议大家使用原厂驱动。
在这里，我解释一下，因为，每块主板不一定是绝对一样，所以，系统驱动主板的参数就不一样，但是你没有封装就GHOST，在别的机器上是可以使用的，安装冰点的时候，由于驱动不一样，当然，冰点不需要主板驱动，它需要的是硬盘驱动，主板的参数不一样，在加上硬盘和主板的连接也可能造成参数的差别，这样，冰点安装的时候，不能正确替换系统原本的驱动，大家有否注意到装显卡驱动的时候，屏幕会闪一次，那是驱动程序在卸载已经加载到内存中的驱动程序文件，所以，冰点要驱动硬盘，就必须卸载，在加上自己的参数，参数改变，冰点不能正确卸载驱动，也就装不上啦。封装就是要把硬件信息从系统中完全删除，刻好以后让系统自己查找合适的驱动，配置合适的参数。
个人认为，论坛里的什么冰点被破解是假的，是枪手帖子，就算被破了， 我们所做的不过是：change another software.国外这样的软件一大堆，只不过广大网管的英语水平不高，也没兴趣去找啊。
在看看他们发帖子的姿态吧，给出图片，但是不给出东西，还说什么是怕流传下来，影响大了，为广大网管着想，中国人，有什么东西还有这样藏的吗？有什么东西只管拿出来，这样发图片，纯粹是危言耸听！
所以，我认为是枪手帖子，目的是要大家选用别的还原软件，仔细看看帖子和发帖子的人说的话，一点技术含量都没有，没有冰点，我们照样工作的很愉快！

2\对于Deep Freeze，我们最大的愿望就是获得她的密码！Deep Freeze的密码存放在系统盘下的Persi0.sys文件中，在一般状态（指Windows系统）下，除了Deep Freeze本身，Persi0.sys文件是不允许进行（打开、复制、粘贴）操作的，再说，即使拿到了Persi0.sys这个文件，Deep Freeze经过层层的加密，要获得密码没有专业的知识基本上不可能！当然获得密码概率是有的，除非管理员是白痴，起了大家一下子就能猜到的密码！既然不能得到密码，那就干脆绕过密码这一关，直接干掉Persi0.sys这个文件！
好了，破解的思路已经出来了－－－利用纯DOS下操作不还原，利用一个知道密码的Persi0.sys文件，替换掉要破解的那个Persi0.sys文件。

先说一下破解的前提条件：
如果你想很快成功而不想浪费太多时间的话，这一步骤不能省略。
1、破解是在Windows XP Pro下进行的，Deep Freeze的版本号是V4.20.020.0613,Persi0.sys这个文件大家可以直接在文章最后的附件中获取，但是鉴于版本的差异，我不能保证Persi0.sys文件的通用性！
2、您要破解的机器上应该有一个DOS操作系统，不管是用MaxDOS安装上去的，还是你用USB启动盘启动的，总之有就可以了！
3、另外，还要有NTFSPro.exe这个文件，用它来操作NTFS分区，如果没有，同样可以在文章最后的附件中找到或者自己从网上下也可以！
4、最后呢，是你的机器支持USB启动（当然，您还应该有一个引导型优盘！NTFSPRO.EXE文件应包含其中！此外您还要知道BIOS的密码，如果有的话）或者他已经安装了纯DOS。
5、假如你还没有优盘，那么至少有一个硬盘的分区应该不还原（用来存放Persi0.sys文件），而且系统本身已经安装了纯DOS。如果DOS有密码，你也应该得到！比如MaxDOS V4.2E的密码存放在C:/boot/grub/menu.lst文件中，默认是max。
6、假设以上条件你不能满足，那么您就只能看看文章了。等下次技术成熟了在破吧！
我在网上搜了好久，没有发现提供Persi0.sys文件下载的网站，看来这个Persi0.sys文件只能是自己搞了！为了能够获得Persi0.sys文件，我先是用VMware安装了一个Windows XP，（对于怎样用VMware安装Windows XP我们在这里不研究，有兴趣的可以查看相关资料），然后把Deep Freeze安装上，我找的是4.2版的，因为系统分区是NTFS，为了能够访问NTFS分区，又安装了MaxDOS（其实只要是能支持NTFS分区的软件都可以）,在纯DOS状态下，将系统盘下的Persi0.sys文件Copy过来，好不容易啊！我是Copy在了U盘上。你呢？
好了，现在可以开始了！
如果你有启动引导型优盘,先要在BIOS中将系统的启动顺序改为从优盘启动，好了保存，重启，等待进入纯DOS后，运行NTFSPro.exe这个文件,使你能够访问NTFS分区的系统盘，然后进入系统盘，重命名或者直接删除Persi0.sys文件（如果你只是搞研究就重命名它，如果你是想搞破坏那就。。。最好不要），然后Copy优盘中的Persi0.sys文件进去，大约20秒搞定，重启，好了是不是看见屏幕右下脚的Deep Freeze图标打了插，而且还一闪一闪的？那么恭喜你！破解成功！现在系统处于未还原状态！你所有的操作都不会被还原－－－除非你按Ctrl+Shift+Alt+F6或按住Shift双击Deep Freeze图标呼出控制面板，把状态改为Freeze。
再说你没有优盘的情况，开机，长按F8，选择进入DOS系统，同理，把你存放在不还原盘中的Persi0.sys文件Copy到系统根目录下，覆盖删除还是重命名这个自己选。现在明白为什么要有一个纯DOS系统，还要一个不还原的盘了吧？不然如何得来Persi0.sys去替换原来的Persi0.sys？
如果你想再改回去，还得在纯DOS下恢复原来的Persi0.sys文件。
至此，整个破解工作结束！
其实，最简单的办法就是启动MaxDOS，在纯DOS下删除Persi0.sys 就可以解除还原（不要干坏事！！！）
申明：其实，使用MaxDOS+Deep Freeze本身就是个错误，再也找不出比这更大的BUG了。
