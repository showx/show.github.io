

<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
    --- - shengsheng的博客
    
    </title>
    
    
    
    <link href="atom.xml" rel="alternate" title="shengsheng的博客" type="application/atom+xml">
    <link rel="stylesheet" href="asset/style.css">
    
</head>
  <body>




        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                          <a class="button-square" href="index.html">
<svg class="svg-inline--fa fa-home fa-w-18" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>
                            </a>
                        
                         
                        
                        
                        
                        <a class="button-square" href="https://github.com/showx" target="_blank" title="github">
                               <svg class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-github fa-lg"></i> -->
                          </a>
                        
                        
                      
                      <a class="button-square" href="atom.xml" target="_blank" title="RSS">
                              <svg class="svg-inline--fa fa-rss fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg><!-- <i class="fas fa-rss fa-lg"></i> -->
                      </a>

              
                       
                         
                        
                    </div>

                    <ul class="site-nav">
                        
                    </ul>
                </div>
            </header>

            <div id="container">

 
<div class="container">
  <article class="post-container">
    <header class="post-header">
        <h1 class="post-title">---</h1>
        <p class="post-date">
                <span>Posted <time datetime="2020/02/06" itemprop="datePublished">2020/02/06</time></span>
            </p>
    </header>

    <div class="post-content clearfix">
<p>layout: post<br/>
title: PHP输入流php://input介绍<br/>
date: 2015-09-10 13:40<br/>
author: admin<br/>
comments: true</p>

<h2 id="toc_0">categories: []</h2>

<p>对一php://input介绍，PHP官方手册文档有一段话对它进行了很明确地概述。</p>

<p>“php://input allows you to read raw POST data. It is a less memory intensive alternative to \(HTTP_RAW_POST_DATA and does not need any special php.ini directives. php://input is not available with enctype=”multipart/form-data”.<br/>
翻译过来，是这样：<br/>
“php://input可以读取没有处理过的POST数据。相较于\)HTTP_RAW_POST_DATA而言，它给内存带来的压力较小，并且不需要特殊的php.ini设置。php://input不能用于enctype=multipart/form-data”</p>

<p>我们应该怎么去理解这段概述呢?!我把它划分为三部分，逐步去理解。<br/>
读取POST数据<br/>
不能用于multipart/form-data类型<br/>
php://input VS $HTTP_RAW_POST_DATA<br/>
读取POST数据</p>

<p>PHPer们一定很熟悉\(_POST这个内置变量。\)_POST与 php://input存在哪些关联与区别呢?另外，客户端向服务端交互数据，最常用的方法除了POST之外，还有GET。既然php://input作 为PHP输入流，它能读取GET数据吗？这二个问题正是我们这节需要探讨的主要内容。<br/>
经验告诉我们，从测试与观察中总结，会是一个很凑效的方法。这里，我写了几个脚本来帮助我们测试。</p>

<p>@file 192.168.0.6:/phpinput_server.php 打印出接收到的数据<br/>
@file 192.168.0.8:/phpinput_post.php 模拟以POST方法提交表单数据<br/>
@file 192.168.0.8:/phpinput_xmlrpc.php 模拟以POST方法发出xmlrpc请求.<br/>
@file 192.168.0.8:/phpinput_get.php 模拟以GET方法提交表单表数<br/>
phpinput_server.php与phpinput_post.php</p>

<p>&lt;?php<br/>
//@file phpinput_server.php<br/>
\(raw_post_data = file_get_contents(&#39;php://input&#39;, &#39;r&#39;);<br/>
echo &quot;-------\$_POST------------------\n&quot;;<br/>
echo var_dump(\)_POST) . &quot;\n&quot;;<br/>
echo &quot;-------php://input-------------\n&quot;;<br/>
echo $raw_post_data . &quot;\n&quot;;<br/>
?&gt;</p>

<p>&lt;?php<br/>
//@file phpinput_post.php<br/>
\(http_entity_body = &#39;n=&#39; . urldecode(&#39;perfgeeks&#39;) . &#39;&amp;amp;p=&#39; . urldecode(&#39;7788&#39;);<br/>
\)http_entity_type = &#39;application/x-www-form-urlencoded&#39;;<br/>
\(http_entity_length = strlen(\)http_entity_body);<br/>
\(host = &#39;192.168.0.6&#39;;<br/>
\)port = 80;<br/>
\(path = &#39;/phpinput_server.php&#39;;<br/>
\)fp = fsockopen(\(host, \)port, \(error_no, \)error_desc, 30);<br/>
if (\(fp) {<br/>
fputs(\)fp, &quot;POST {\(path} HTTP/1.1\r\n&quot;);<br/>
fputs(\)fp, &quot;Host: {\(host}\r\n&quot;);<br/>
fputs(\)fp, &quot;Content-Type: {\(http_entity_type}\r\n&quot;);<br/>
fputs(\)fp, &quot;Content-Length: {\(http_entity_length}\r\n&quot;);<br/>
fputs(\)fp, &quot;Connection: close\r\n\r\n&quot;);<br/>
fputs(\(fp, \)http_entity_body . &quot;\r\n\r\n&quot;);</p>

<p>while (!feof(\(fp)) {<br/>
\)d .= fgets(\(fp, 4096);<br/>
}<br/>
fclose(\)fp);<br/>
echo $d;<br/>
}<br/>
?&gt;<br/>
我们可以通过使用工具ngrep抓取http请求包（因为我们需要探知的是php://input，所以我们这里只抓取http Request数据包）。我们来执行测试脚本phpinput_post.php</p>

<p>@php /phpinput_post.php<br/>
HTTP/1.1 200 OK<br/>
Date: Thu, 08 Apr 2010 03:23:36 GMT<br/>
Server: Apache/2.2.3 (CentOS)<br/>
X-Powered-By: PHP/5.1.6<br/>
Content-Length: 160<br/>
Connection: close<br/>
Content-Type: text/html; charset=UTF-8<br/>
-------$_POST------------------<br/>
array(2) {<br/>
[&quot;n&quot;]=&gt; string(9) &quot;perfgeeks&quot;<br/>
[&quot;p&quot;]=&gt; string(4) &quot;7788&quot;<br/>
}<br/>
-------php://input-------------<br/>
n=perfgeeks&amp;p=7788<br/>
通过ngrep抓到的http请求包如下:</p>

<p>T 192.168.0.8:57846 -&gt; 192.168.0.6:80 [AP]<br/>
POST /phpinput_server.php HTTP/1.1..<br/>
Host: 192.168.0.6..Content-Type: application/x-www-form-urlencoded..Co<br/>
ntent-Length: 18..Connection: close....n=perfgeeks&amp;p=7788....<br/>
仔细观察，我们不难发现<br/>
1，$_POST数据,php://input 数据与httpd entity body数据是“一致”的<br/>
2，http请求中的Content-Type是application/x-www-form-urlencoded ，它表示http请求body中的数据是使用http的post方法提交的表单数据，并且进行了urlencode()处理。<br/>
(注:注意加粗部分内容，下文不再提示).</p>

<p>我们再来看看脚本phpinput_xmlrpc.php的原文件内容，它模拟了一个POST方法提交的xml-rpc请求。</p>

<p>&lt;?php<br/>
//@file phpinput_xmlrpc.php<br/>
\(http_entity_body = &quot;\n\n jt_userinfo\n&quot;;<br/>
\)http_entity_type = &#39;text/html&#39;;<br/>
\(http_entity_length = strlen(\)http_entity_body);<br/>
\(host = &#39;192.168.0.6&#39;;<br/>
\)port = 80;<br/>
\(path = &#39;/phpinput_server.php&#39;;<br/>
\)fp = fsockopen(\(host, \)port, \(error_no, \)error_desc, 30);<br/>
if (\(fp) {<br/>
fputs(\)fp, &quot;POST {\(path} HTTP/1.1\r\n&quot;);<br/>
fputs(\)fp, &quot;Host: {\(host}\r\n&quot;);<br/>
fputs(\)fp, &quot;Content-Type: {\(http_entity_type}\r\n&quot;);<br/>
fputs(\)fp, &quot;Content-Length: {\(http_entity_length}\r\n&quot;);<br/>
fputs(\)fp, &quot;Connection: close\r\n\r\n&quot;);<br/>
fputs(\(fp, \)http_entity_body . &quot;\r\n\r\n&quot;);<br/>
while (!feof(\(fp)) {<br/>
\)d .= fgets($fp, 4096);<br/>
}</p>

<p>fclose(\(fp);<br/>
echo \)d;<br/>
}<br/>
?&gt;<br/>
同样地，让我们来执行这个测试脚本</p>

<p>@php /phpinput_xmlrcp.php<br/>
HTTP/1.1 200 OK<br/>
Date: Thu, 08 Apr 2010 03:47:18 GMT<br/>
Server: Apache/2.2.3 (CentOS)<br/>
X-Powered-By: PHP/5.1.6<br/>
Content-Length: 154<br/>
Connection: close<br/>
Content-Type: text/html; charset=UTF-8</p>

<p>-------$_POST------------------<br/>
array(0) {<br/>
}</p>

<p>-------php://input-------------<br/>
&lt;?xml version=&quot;1.0&quot;&gt;<br/>
&lt;methodcall&gt;<br/>
&lt;name&gt;jt_userinfo&lt;/name&gt;<br/>
&lt;/methodcall&gt;<br/>
执行这个脚本的时候，我们通过ngrep抓取的http请求数据包如下</p>

<p>T 192.168.0.8:45570 -&gt; 192.168.0.6:80 [AP]<br/>
POST /phpinput_server.php HTTP/1.1..<br/>
Host: 192.168.0.6..Content-Type: text/html..Content-Length: 75..Connec<br/>
tion: close....&lt;?xml version=&quot;1.0&quot;&gt;.&lt;methodcall&gt;. &lt;name&gt;jt_userinfo&lt;<br/>
/name&gt;.&lt;/methodcall&gt;....<br/>
同样，我样也可以很容易地发现:<br/>
1，http请求中的Content-Type是text/xml。它表示http请求中的body数据是xml数据格式。<br/>
2，服务端\(_POST打印出来的是一个空数组，即与http entity body不一致了。这跟上个例子不一样了，这里的Content-Type是text/xml,而不是application/x-www-form-urlencoded<br/>
3，而php://input数据还是跟http entity body数据一致。也就是php://input数据和\)_POST数据不一致了。</p>

<p>我们再来看看通过GET方法提交表单数据的情况，php://input能不能读取到GET方法的表单数据？在这里，我们稍加改动一下phpinput_server.php文件，将\(_POST改成\)_GET。<br/>
<div class="codetitle"><a id="copybut95495" class="copybut"></a><u>复制代码</u>代码如下:</div><br/>
<div id="code95495" class="codebody"><br/>
&lt;?php<br/>
//@file phpinput_server.php<br/>
\(raw_post_data = file_get_contents(&#39;php://input&#39;, &#39;r&#39;);<br/>
echo &quot;-------\$_GET------------------\n&quot;;<br/>
echo var_dump(\)_GET) . &quot;\n&quot;;<br/>
echo &quot;-------php://input-------------\n&quot;;<br/>
echo \(raw_post_data . &quot;\n&quot;;<br/>
?&amp;gt;<br/>
&amp;lt;?php<br/>
//@file phpinput_get.php<br/>
\)query_path = &#39;n=&#39; . urldecode(&#39;perfgeeks&#39;) . &#39;&amp;p=&#39; . urldecode(&#39;7788&#39;);<br/>
\(host = &#39;192.168.0.6&#39;;<br/>
\)port = 80;<br/>
\(path = &#39;/phpinput_server.php&#39;;<br/>
\)d = &#39;&#39;;<br/>
\(fp = fsockopen(\)host, \(port, \)error_no, \(error_desc, 30);<br/>
if (\)fp) {<br/>
fputs(\(fp, &quot;GET {\)path}?{\(query_path} HTTP/1.1\r\n&quot;);<br/>
fputs(\)fp, &quot;Host: {\(host}\r\n&quot;);<br/>
fputs(\)fp, &quot;Connection: close\r\n\r\n&quot;);</p>

<p>while (!feof(\(fp)) {<br/>
\)d .= fgets(\(fp, 4096);<br/>
}<br/>
fclose(\)fp);<br/>
echo $d;<br/>
}<br/>
?&gt;</div><br/>
同样，我们执行下一phpinput_get.php测试脚本，它模拟了一个通常情况下的GET方法提交表单数据。</p>

<p>@php /phpinput_get.php<br/>
HTTP/1.1 200 OK<br/>
Date: Thu, 08 Apr 2010 07:38:15 GMT<br/>
Server: Apache/2.2.3 (CentOS)<br/>
X-Powered-By: PHP/5.1.6<br/>
Content-Length: 141<br/>
Connection: close<br/>
Content-Type: text/html; charset=UTF-8</p>

<p>-------$_GET------------------<br/>
array(2) {<br/>
[&quot;n&quot;]=&gt;<br/>
string(9) &quot;perfgeeks&quot;<br/>
[&quot;p&quot;]=&gt;<br/>
string(4) &quot;7788&quot;<br/>
}</p>

<p>-------php://input-------------<br/>
在这个时候，使用ngrep工具，捕获的相应的http请求数据包如下</p>

<p>T 192.168.0.8:36775 -&gt; 192.168.0.6:80 [AP]<br/>
GET /phpinput_server.php?n=perfgeeks&amp;p=7788 HTTP/1.1..<br/>
Host: 192.168.0.6..Connection: close....<br/>
比较POST方法提交的http请求，通常GET方法提交的请求中，entity body为空。同时，不会指定Content-Type和Content-Length。但是，如果强硬数据http entity body，并指明正确地Content-Type和Content-Length,那么php://input还可是读取得到http entity body数据，但不是$_GET数据。</p>

<p>所根据，上面几个探测，我们可以作出以下总结:<br/>
1，Content- Type取值为application/x-www-form-urlencoded时，php会将http请求body相应数据会填入到数 组\(_POST，填入到\)_POST数组中的数据是进行urldecode()解析的结果。（其实，除了该Content-Type，还有 multipart/form-data表示数据是表单数据，稍后我们介绍）<br/>
2，php://input数据，只要Content-Type不为 multipart/form-data(该条件限制稍后会介绍)。那么php://input数据与http entity body部分数据是一致的。该部分相一致的数据的长度由Content-Length指定。<br/>
3，仅当Content-Type为application/x-www-form-urlencoded且提交方法是POST方法时，\(_POST数据与php://input数据才是”一致”（打上引号，表示它们格式不一致，内容一致）的。其它情况，它们都不一致。<br/>
4，php://input读取不到\)_GET数据。是因为$_GET数据作为query_path写在http请求头部(header)的PATH字段，而不是写在http请求的body部分。</p>

<p>这也帮助我们理解了，为什么xml_rpc服务端读取数据都是通过file_get_contents(‘php://input&#39;, ‘r&#39;)。而不是从$_POST中读取，正是因为xml_rpc数据规格是xml，它的Content-Type是text/xml。<br/>
php://input碰到了multipart/form-data</p>

<p>上传文件的时候，表单的写法是这样的<br/>
<div class="codetitle"><a id="copybut87209" class="copybut"></a><u>复制代码</u>代码如下:</div><br/>
<div id="code87209" class="codebody"><br/>
&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;phpinput_server.php&quot; method=&quot;POST&quot; &gt;<br/>
&lt;input type=&quot;text&quot; name=&quot;n&quot; /&gt;<br/>
&lt;input type=&quot;file&quot; name=&quot;f&quot; /&gt;<br/>
&lt;input type=&quot;submit&quot; value=&quot;upload now&quot; /&gt;<br/>
&lt;/form&gt;</div><br/>
那么，enctype=multipart/form-data这里的意义，就是将该次http请求头部(head)中的Content-Type设置为multipart/form-data。请查阅RFC1867对 它的描述。multipart/form-data也表示以POST方法提交表单数据，它还伴随了文件上传，所以会跟application/x- www-form-urlencoded数据格式不一样。它会以一更种更合理的，更高效的数据格式传递给服务端。我们提交该表单数据，并且打印出响应结 果，如下:</p>

<p>-------$_POST------------------<br/>
array(1) { [&quot;n&quot;]=&gt; string(9) &quot;perfgeeks&quot; }<br/>
-------php://input-------------<br/>
同时，我们通过ngrep抓取的相应的http请求数据包如下:</p>

<p>T 192.168.0.8:3981 -&gt; 192.168.0.6:80 [AP]<br/>
POST /phpinput_server.php HTTP/1.1..Host: 192.168.0.6..Connection: kee<br/>
p-alive..User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) A<br/>
ppleWebKit/533.2 (KHTML, like Gecko) Chrome/5.0.342.3 Safari/533.2..Re<br/>
ferer: <a href="http://192.168.0.6/phpinput_server.php..Content-Length">http://192.168.0.6/phpinput_server.php..Content-Length</a>: 306..Ca<br/>
che-Control: max-age=0..Origin: <a href="http://192.168.0.6..Content-Type">http://192.168.0.6..Content-Type</a>: mult<br/>
ipart/form-data; boundary=----WebKitFormBoundarybLQwkp4opIEZn1fA..Acce<br/>
pt: application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q<br/>
=0.8,image/png,<em>/</em>;q=0.5..Accept-Encoding: gzip,deflate,sdch..Accept-L<br/>
anguage: zh-CN,zh;q=0.8..Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3..Cook<br/>
ie: SESS3b0e658f87cf58240de13ab43a399df6=lju6o5bg8u04lv1ojugm2ccic6...<br/>
.</p>

<p>T 192.168.0.8:3981 -&gt; 192.168.0.6:80 [AP]<br/>
------WebKitFormBoundarybLQwkp4opIEZn1fA..Content-Disposition: form-da<br/>
ta; name=&quot;n&quot;....perfgeeks..------WebKitFormBoundarybLQwkp4opIEZn1fA..C<br/>
ontent-Disposition: form-data; name=&quot;f&quot;; filename=&quot;test.txt&quot;..Content-<br/>
Type: text/plain....i am file..multipart/form-data..------WebKitFormBo<br/>
undarybLQwkp4opIEZn1fA--..</p>

<p>从响应输出来比对，\(_POST数据跟请求提交数据相符，即\)_POST = array(‘n&#39; =&gt; ‘perfgeeks&#39;)。这也跟http请求body中的数据相呼应，同时说明PHP把相应的数据填入$_POST全局变量。而php://input 输出为空，没有输出任何东西，尽管http请求数据包中body不为空。这表示，当Content-Type为multipart/form-data的 时候，即便http请求body中存在数据，php://input也为空，PHP此时，不会把数据填入php://input流。所以，可以确定: php://input不能用于读取enctype=multipart/form-data数据。</p>

<p>我们再比较这次通过ngrep抓取的http请求数据包，我们会发现，最大不同的一 点是Content-Type后面跟了boundary定义了数据的分界符，bounday是随机生成的。另外一个大不一样的，就是http entity body中的数据组织结构不一样了。</p>

<p>上一节，我们概述了，当Content-Type为application/x- www-form-urlencoded时，php://input和\(_POST数据是“一致”的，为其它Content-Type的时候，php: //input和\)_POST数据数据是不一致的。因为只有在Content-Type为application/x-www-form- urlencoded或者为multipart/form-data的时候，PHP才会将http请求数据包中的body相应部分数据填入\(_POST全 局变量中,其它情况PHP都忽略。而php://input除了在数据类型为multipart/form-data之外为空外，其它情况都可能不为空。 通过这一节，我们更加明白了php://input与\)_POST的区别与联系。所以，再次确认，php://input无法读取 enctype=multipart/form-data数据，当php://input遇到它时，永远为空，即便http entity body有数据。<br/>
php://input VS $http_raw_post_data</p>

<p>相信大家对php://input已经有一定深度地了解了。那 么\(http_raw_post_data是什么呢？\)http_raw_post_data是PHP内置的一个全局变量。它用于，PHP在无法识别的 Content-Type的情况下，将POST过来的数据原样地填入变量\(http_raw_post_data。它同样无法读取Content- Type为multipart/form-data的POST数据。需要设置php.ini中的 always_populate_raw_post_data值为On，PHP才会总把POST数据填入变量\)http_raw_post_data。</p>

<p>把脚本phpinput_server.php改变一下，可以验证上述内容<br/>
<div class="codetitle"><a id="copybut65183" class="copybut"></a><u>复制代码</u>代码如下:</div><br/>
<div id="code65183" class="codebody"><br/>
&lt;?php<br/>
\(raw_post_data = file_get_contents(&#39;php://input&#39;, &#39;r&#39;);<br/>
\)rtn = (\(raw_post_data == \)HTTP_RAW_POST_DATA) ? 1 : 0;<br/>
echo $rtn;<br/>
?&gt;</div><br/>
执行测试脚本</p>

<p>@php phpinput_post.php<br/>
@php phpinput_get.php<br/>
@php phpinput_xmlrpc.php</p>

<p>得出的结果输出都是一样的，即都为1，表示php://input和$HTTP_RAW_POST_DATA是相同的。至于对内存的压力，我们这里就不做细致地测试了。有兴趣的，可以通过xhprof进行测试和观察。</p>

<p>以此，我们这节可以总结如下:<br/>
1, php://input 可以读取http entity body中指定长度的值,由Content-Length指定长度,不管是POST方式或者GET方法提交过来的数据。但是，一般GET方法提交数据 时，http request entity body部分都为空。<br/>
2,php://input 与$HTTP_RAW_POST_DATA读取的数据是一样的，都只读取Content-Type不为multipart/form-data的数据。<br/>
学习笔记</p>

<p>1，Coentent-Type仅在取值为application/x-www-data-urlencoded和multipart/form-data两种情况下，PHP才会将http请求数据包中相应的数据填入全局变量\(_POST<br/>
2，PHP不能识别的Content-Type类型的时候，会将http请求包中相应的数据填入变量\)HTTP_RAW_POST_DATA<br/>
3, 只有Coentent-Type不为multipart/form-data的时候，PHP不会将http请求数据包中的相应数据填入php://input，否则其它情况都会。填入的长度，由Coentent-Length指定。<br/>
4，只有Content-Type为application/x-www-data-urlencoded时，php://input数据才跟\(_POST数据相一致。<br/>
5，php://input数据总是跟\)HTTP_RAW_POST_DATA相同，但是php://input比\(HTTP_RAW_POST_DATA更凑效，且不需要特殊设置php.ini<br/>
6，PHP会将PATH字段的query_path部分，填入全局变量\)_GET。通常情况下，GET方法提交的http请求，body为空。</p>

    </div>
    <footer class="post-footer clearfix">
      
           
      
        
    </footer>
     <div class="comments-wrap">
        <div class="share-comments">
          

          

          
        </div>
      </div><!-- end comments wrap -->
  </article>
 </div><!-- end-->



    <footer class="footer">
            <div class="container">
                <div class="site-footer-wrapper">
                        <a class="button-square" href="index.html">
<svg class="svg-inline--fa fa-home fa-w-18" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>
                            </a>
                        
                         
                        
                        
                        
                        <a class="button-square" href="https://github.com/showx" target="_blank" title="github">
                               <svg class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-github fa-lg"></i> -->
                          </a>
                        
                        
                      
                      <a class="button-square" href="atom.xml" target="_blank" title="RSS">
                              <svg class="svg-inline--fa fa-rss fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg><!-- <i class="fas fa-rss fa-lg"></i> -->
                      </a>

              
                       
                                                
                </div>
                <div class="site-menu-wrapper">
                  &nbsp;<span>|</span>&nbsp;
                  
                    <a target="self" class="" href="index.html">Home</a>
                    &nbsp;<span>|</span>&nbsp;
                  
                    <a target="_self" class="" href="archives.html">Archives</a>
                    &nbsp;<span>|</span>&nbsp;
                                             
                </div>

                <p class="footer-copyright">
                        Copyright &copy; 2019
                        Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
                        Theme used <a target="_blank" href="https://blog.timac.org">Timac</a>.
                </p>
            </div>
        </footer>



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  













        
      
  
    


    </body>
</html>
