

<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
    --- - shengsheng的博客
    
    </title>
    
    
    
    <link href="atom.xml" rel="alternate" title="shengsheng的博客" type="application/atom+xml">
    <link rel="stylesheet" href="asset/style.css">
    
</head>
  <body>




        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                          <a class="button-square" href="index.html">
<svg class="svg-inline--fa fa-home fa-w-18" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>
                            </a>
                        
                         
                        
                        
                        
                        <a class="button-square" href="https://github.com/showx" target="_blank" title="github">
                               <svg class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-github fa-lg"></i> -->
                          </a>
                        
                        
                      
                      <a class="button-square" href="atom.xml" target="_blank" title="RSS">
                              <svg class="svg-inline--fa fa-rss fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg><!-- <i class="fas fa-rss fa-lg"></i> -->
                      </a>

              
                       
                         
                        
                    </div>

                    <ul class="site-nav">
                        
                    </ul>
                </div>
            </header>

            <div id="container">

 
<div class="container">
  <article class="post-container">
    <header class="post-header">
        <h1 class="post-title">---</h1>
        <p class="post-date">
                <span>Posted <time datetime="2020/02/06" itemprop="datePublished">2020/02/06</time></span>
            </p>
    </header>

    <div class="post-content clearfix">
<p>layout: post<br/>
title: SVN Hooks总结<br/><br/>
date: 2013-10-30 09:02<br/>
author: admin<br/>
comments: true</p>

<h2 id="toc_0">categories: []</h2>

<p>子脚本无非是利用后台的管理命令和所需要使用的hooks提供的参数。来进行的一些组合，满足的需求！<br/>
下面的帖子，先介绍了后台管理命令。然后再介绍了钩子脚本的作用和几个Demo。</p>

<p>有个前提，我觉得作为一个合格的SCM，还是有必要学点Shell或bat的写法。</p>

<p>所以对于看不明白钩子的同学，可以先学下Shell的基础知识。</p>

<p>不然只是一个理论上的SCM。</p>

<p>一.服务器后台管理命令</p>

<p>1.svnlook</p>

<p>1)svnlook author</p>

<p>可跟选项</p>

<p>--revision (-r)</p>

<p>--transaction (-t)</p>

<p>打印版本库一个修订版本或者事物的作者。</p>

<p>svnlook author -r 40 /usr/local/svn/repos</p>

<p>2)svnlook cat</p>

<p>打印一个文件的内容</p>

<p>svnlook cat REPOS_PATH PATH_IN_REPOS</p>

<p>可跟选项</p>

<p>--revision (-r)</p>

<p>--transaction (-t)</p>

<p>svnlook cat -t ax8 /usr/local/svn/repos /trunk/README</p>

<p>svnlook cat -r 40 /usr/local/svn/repos /trunk/README</p>

<p>3)svnlook changed</p>

<p>打印修改的路径。</p>

<p>svnlook changed REPOS_PATH --最后一次修改</p>

<p>svn update样式的”状态字符：</p>

<p>&#39;A &#39;----条目添加到版本库。</p>

<p>&#39;D &#39;----条目从版本库删除。</p>

<p>&#39;U &#39;----文件内容改变了。</p>

<p>&#39;_U&#39;----条目属性改变了。</p>

<p>&#39;UU&#39;----文件内容和属性修改了。</p>

<p>文件和目录可以区分，目录路径后面会显示字符&#39;/&#39;。</p>

<p>可跟选项</p>

<p>--revision (-r)</p>

<p>--transaction (-t)</p>

<p>svnlook changed -r 39 /usr/local/svn/repos</p>

<p>4)svnlook date</p>

<p>$ svnlook date -r 40 /tmp/repos/</p>

<p>2003-02-22 17:44:49 -0600 (Sat, 22 Feb 2003)</p>

<p>5)svnlook diff</p>

<p>svnlook diff REPOS_PATH</p>

<p>可跟选项</p>

<p>--revision (-r)</p>

<p>--transaction (-t)</p>

<p>--no-diff-added</p>

<p>--no-diff-deleted</p>

<p>$svnlook diff -r 40 /usr/local/svn/repos/</p>

<p>Copied: egg.txt (from rev 39, trunk/vendors/deli/pickle.txt)</p>

<p>Added: trunk/vendors/deli/soda.txt</p>

<h1 id="toc_1"></h1>

<p>Modified: trunk/vendors/deli/sandwich.txt</p>

<h1 id="toc_2"></h1>

<p>--- trunk/vendors/deli/sandwich.txt (original)</p>

<p>+++ trunk/vendors/deli/sandwich.txt 2003-02-22 17:45:04.000000000 -0600</p>

<p>@@ -0,0 +1 @@</p>

<p>+Don&#39;t forget the mayo!</p>

<p>Modified: trunk/vendors/deli/logo.jpg</p>

<h1 id="toc_3"></h1>

<p>(Binary files differ)</p>

<p>Deleted: trunk/vendors/deli/chips.txt</p>

<h1 id="toc_4"></h1>

<p>Deleted: trunk/vendors/deli/pickle.txt</p>

<h1 id="toc_5"></h1>

<p>如果一个文件有非文本的svn:mime-type属性，区别不会明确显示。</p>

<p>6)svnlook dirs-changed</p>

<p>打印本身修改的目录</p>

<p>svnlook dirs-changed REPOS_PATH</p>

<p>可跟选项</p>

<p>--revision (-r)</p>

<p>--transaction (-t)</p>

<p>$svnlook dirs-changed -r 40 /usr/local/svn/repos</p>

<p>trunk/vendors/deli/</p>

<p>7)svnlook history</p>

<p>打印版本库（如果没有路径，则是根目录）某一个路径的历史。</p>

<p>可跟选项</p>

<p>--revision (-r)</p>

<p>--show-ids</p>

<p>$ svnlook history -r 20 /usr/local/svn/repos /tags/1.0 --show-ids</p>

<p>REVISION    PATH &lt;ID&gt;</p>

<hr/>

<pre><code class="language-text">   19    /tags/1.0 &amp;lt;1.2.12&amp;gt;

   17    /branches/1.0-rc2 &amp;lt;1.1.10&amp;gt;

   16    /branches/1.0-rc2 &amp;lt;1.1.x&amp;gt;

   14    /trunk &amp;lt;1.0.q&amp;gt;

   13    /trunk &amp;lt;1.0.o&amp;gt;

   11    /trunk &amp;lt;1.0.k&amp;gt;

    9    /trunk &amp;lt;1.0.g&amp;gt;

    8    /trunk &amp;lt;1.0.e&amp;gt;

    7    /trunk &amp;lt;1.0.b&amp;gt;

    6    /trunk &amp;lt;1.0.9&amp;gt;

    5    /trunk &amp;lt;1.0.7&amp;gt;

    4    /trunk &amp;lt;1.0.6&amp;gt;

    2    /trunk &amp;lt;1.0.3&amp;gt;

    1    /trunk &amp;lt;1.0.2&amp;gt;
</code></pre>

<p>8)svnlook info</p>

<p>打印作者、时间戳、日志信息大小和日志信息。</p>

<p>svnlook info REPOS_PATH</p>

<p>可跟选项</p>

<p>--revision (-r)</p>

<p>--transaction (-t)</p>

<p>$ svnlook info -r 40 /usr/local/svn/repos</p>

<p>sally</p>

<p>2003-02-22 17:44:49 -0600 (Sat, 22 Feb 2003)</p>

<p>15</p>

<p>Rearrange lunch.</p>

<p>9）svnlook lock</p>

<p>打印PATH_IN_REPOS锁定的所有信息，如果 PATH_IN_REPOS没有锁定，则不打印任何内容。</p>

<p>这描述了文件tree.jpg的锁定。</p>

<p>$ svnlook lock /svn/repos /trunk/tree.jpg</p>

<p>UUID Token: opaquelocktoken:ab00ddf0-6afb-0310-9cd0-dda813329753</p>

<p>Owner: harry</p>

<p>Created: 2005-07-08 17:27:36 -0500 (Fri, 08 Jul 2005)</p>

<p>Expires:</p>

<p>Comment (1 line):</p>

<p>Rework the uppermost branches on the bald cypress in the foreground.</p>

<p>10）svnlook log</p>

<p>打印日志信息。</p>

<p>svnlook log REPOS_PATH</p>

<p>--revision (-r)</p>

<p>--transaction (-t)</p>

<p>例子</p>

<p>这显示了实例版本库在修订版本40的日志输出：</p>

<p>可跟选项</p>

<p>--revision (-r)</p>

<p>--transaction (-t)</p>

<p>$ svnlook log /tmp/repos/</p>

<p>Rearrange lunch.</p>

<p>11）svnlook tree</p>

<p>打印树。</p>

<p>svnlook tree REPOS_PATH [PATH_IN_REPOS]</p>

<p>打印树，从PATH_IN_REPOS（如果提供，会作为树的根）开始，可以选择显示节点修订版本ID。</p>

<p>可跟选项</p>

<p>--revision (-r)</p>

<p>--transaction (-t)</p>

<p>--show-ids</p>

<p>12)svnlook youngest</p>

<p>打印最年轻的修订版本号。</p>

<p>这显示了在实例版本库显示最年轻的修订版本：</p>

<p>$ svnlook youngest /tmp/repos/</p>

<p>42</p>

<p>2.svnadmin</p>

<p>1)svnadmin hotcopy — 制作一个版本库的热备份。</p>

<p>svnadmin hotcopy REPOS_PATH NEW_REPOS_PATH</p>

<p>2)svnadmin dump — 将文件系统的内容转储到标准输出。</p>

<p>svnadmin dump不会保留修改文件的所有内容，而只是记录修改的部分。</p>

<p>这样减少（有些情况下是非常大的）了svnadmin dump产生的转储文件的大小。</p>

<p>然而，也有缺点—增量转储文件需要更多的CPU来创建，也不可以用svndumpfilter操作，</p>

<p>也不如非增量文件容易被如gzip和bzip2等第三方工具压缩。</p>

<p>转储整个版本库：</p>

<p>$ svnadmin dump /usr/local/svn/repos</p>

<p>SVN-fs-dump-format-version: 1</p>

<p>Revision-number: 0</p>

<ul>
<li>Dumped revision 0.</li>
</ul>

<p>Prop-content-length: 56</p>

<p>Content-length: 56</p>

<p>…</p>

<p>从版本库增量转储一个单独的事务：</p>

<p>$ svnadmin dump /usr/local/svn/repos -r 21 --incremental</p>

<ul>
<li>Dumped revision 21.</li>
</ul>

<p>SVN-fs-dump-format-version: 1</p>

<p>Revision-number: 21</p>

<p>Prop-content-length: 101</p>

<p>Content-length: 101</p>

<p>…</p>

<p>二.hooks简介</p>

<p>钩子脚本在每个repos的hooks目录下面。</p>

<p>每个里面都有模板，名字如下：</p>

<p>post-commit.tmpl  post-revprop-change.tmpl  pre-commit.tmpl  pre-revprop-change.tmpl  start-commit.tmpl</p>

<p>post-lock.tmpl    post-unlock.tmpl          pre-lock.tmpl    pre-unlock.tmpl</p>

<p>下面对每个钩子的功用 做一个说明！</p>

<p>1)start-commit — 开始提交的通知</p>

<p>描述</p>

<p>start-commit 在开始事务之前执行。通常用来确定用户是否有提交权限。</p>

<p>如果 start-commit 钩子程序返回非零值，提交就会在创建事务之前停止，stderr 的任何输出都会返回到客户端。</p>

<p>输入参数</p>

<p>传递给你钩子程序的命令行参数，按照顺序是：</p>

<p>1.版本库路径</p>

<p>2.认证过的尝试提交的用户名</p>

<p>3.Colon-separated list of capabilities that a client passes to the server, including depth, mergeinfo, and log-revprops (new in Subversion 1.5).</p>

<p>2)pre-commit — 在提交结束之前提醒。</p>

<p>描述</p>

<p>pre-commit 钩子在事务创建新版本之前运行。通常这个钩子是用来保护因为内容或位置(例如，你要求所有到一个特定分支的提交必须包括一个 bug 追踪的 ticket 号，或者是要求日志信息不为空)而不允许的提交。</p>

<p>如果 pre-commit 钩子返回非零值，提交会终止，提交事务被删除，所有 stderr 的输出会返回到客户端。</p>

<p>输入参数</p>

<p>传递给你钩子程序的命令行参数，按照顺序是：</p>

<p>1.版本库路径</p>

<p>2.提交事务的名称</p>

<p>3)post-commit — 成功提交的通知。</p>

<p>描述</p>

<p>post-commit 钩子在事务完成，创建新版本后执行。大多数人用这个钩子来发送关于提交的描述性电子邮件，或者用来提醒其它工具(例如问题跟踪)，发生了提交动作。一些配置也使用这个钩子触发版本库的备份进程。</p>

<p>如果 post-commit 钩子返回非零值，提交不会终止，因为它已经完成。然后，所有 stderr 的输出都会返回到客户端，让诊断钩子的失败更容易。</p>

<p>输入参数</p>

<p>传递给你钩子程序的命令行参数，按照顺序是：</p>

<p>1.版本库路径</p>

<p>2.提交创建的修订版本号</p>

<p>4)pre-revprop-change — 修订版本属性修改的通知。</p>

<p>描述</p>

<p>pre-revprop-change 钩子在修改版本属性修改之前，正常提交范围之外被执行。不象其它钩子，这个钩子默认是拒绝所有的属性修改，钩子必须实际存在，并且返回一个零值，这样才能修改属性。</p>

<p>如果 pre-revprop-change 钩子不存在，不可执行，或返回非零值，就不会修改属性，所有的 stderr 的输出会返回到客户端。</p>

<p>输入参数</p>

<p>传递给你钩子程序的命令行参数，按照顺序是：</p>

<p>1.版本库路径</p>

<p>2.要修改属性的修订版本</p>

<p>3.企图修改属性的认证用户名</p>

<p>4.属性名称已修改</p>

<p>5.变更描述：A (添加的)，D (删除的)或M (修改的)</p>

<p>此外，Subversion 通过标准输入将属性的新值传递给钩子程序。</p>

<p>5)post-revprop-change — 修订版本属性修改成功的通知</p>

<p>post-revprop-change 钩子会在修改版本属性修改后立即执行，在提交范围之外。可以从其配对 pre-revprop-change 知道，如果没有实现 pre-revprop-change 钩子，它就不会执行。它通常用来在属性修改后发送邮件通知。</p>

<p>如果 post-revprop-change 钩子返回非零值，修改动作不会终止，因为它已经完成。然而，任何输出到 stderr 的内容都会返回到客户端，让诊断钩子的失败更容易。</p>

<p>输入参数</p>

<p>传递给你钩子程序的命令行参数，按照顺序是：</p>

<p>1.版本库路径</p>

<p>2.经修改属性的修订版本</p>

<p>3.做出修改的认证用户名</p>

<p>4.属性名称已修改</p>

<p>5.变更描述：A (添加的)，D (删除的)或M (修改的)</p>

<p>此外，Subversion 通过标准输入将属性的前一个值传递给钩子。</p>

<p>6)post-revprop-change — 修订版本属性修改成功的通知</p>

<p>描述</p>

<p>post-revprop-change 钩子会在修改版本属性修改后立即执行，在提交范围之外。可以从其配对 pre-revprop-change 知道，如果没有实现 pre-revprop-change 钩子，它就不会执行。它通常用来在属性修改后发送邮件通知。</p>

<p>如果 post-revprop-change 钩子返回非零值，修改动作不会终止，因为它已经完成。然而，任何输出到 stderr 的内容都会返回到客户端，让诊断钩子的失败更容易。</p>

<p>输入参数</p>

<p>传递给你钩子程序的命令行参数，按照顺序是：</p>

<p>1.版本库路径</p>

<p>2.已经修改属性的修订版本</p>

<p>3.做出修改的认证用户名</p>

<p>4.属性名称已修改</p>

<p>5.变更描述：A (添加的)，D (删除的)或M (修改的)</p>

<p>此外，Subversion 通过标准输入将属性的前一个值传递给钩子。</p>

<p>7)post-lock — 成功锁定路径的通知。</p>

<p>描述</p>

<p>post-lock 在路径锁定后执行。通常用来发送锁定事件邮件通知。</p>

<p>如果 post-lock 钩子返回非零值，锁定动作不会终止，因为它已经完成。然而，任何输出到 stderr 的内容都会返回到客户端，让诊断钩子的失败更容易。</p>

<p>输入参数</p>

<p>传递给你钩子程序的命令行参数，按照顺序是：</p>

<p>1.版本库路径</p>

<p>2.锁定路径的认证用户名</p>

<p>此外，锁定路径通过标准输入传递给钩子程序，每行一个路径。</p>

<p>8)pre-unlock — 路径解锁尝试的通知。</p>

<p>描述</p>

<p>pre-unlock 钩子在某人企图删除一个文件上的钩子时发生。可以用来创建哪些用户可以解锁哪些文件的策略。制定解锁策略非常重要。如果用户 A 锁定了一个文件，允许用户 B 打开这个锁？如果这个锁已经一周了呢？这种事情可以通过钩子决定并强制执行。</p>

<p>如果 pre-unlock 返回非零值，解锁操作会终止，任何输出到 stderr 的内容都会返回到客户端。</p>

<p>输入参数</p>

<p>传递给你钩子程序的命令行参数，按照顺序是：</p>

<p>1.版本库路径</p>

<p>2.Versioned path which is to be unlocked</p>

<p>3.Authenticated username of the person attempting the unlock</p>

<p>9)post-unlock — 路径成功解锁的通知。</p>

<p>描述</p>

<p>post-unlock 在一个或多个路径已经被解锁后执行。通常用来发送解锁事件通知邮件。</p>

<p>如果 post-unlock 返回非零值，解锁过程不会终止，因为它已经完成。然而，任何输出到 stderr 的内容都会返回到客户端，让诊断钩子的失败更容易。</p>

<p>输入参数</p>

<p>传递给你钩子程序的命令行参数，按照顺序是：</p>

<p>1.版本库路径</p>

<p>2.路径解锁的认证用户名</p>

<p>此外，解锁路径通过标准输入传递给钩子程序，每行一个路径。</p>

<p>三.hooks本应用demo</p>

<p>就是要充分利用2个后台管理命令，以及每个hooks脚本里面传入的参数，进行相关的操作。</p>

<p>1.如果不想开发人员有删除权限，只有SCM用户有删除权限...</p>

<p>REPOS=&quot;$1&quot;</p>

<p>TXN=&quot;$2&quot;</p>

<p>RES=&quot;OK&quot;</p>

<h1 id="toc_6">USER=&quot;$3&quot;</h1>

<p>Sorry~没有这个变量 呵呵</p>

<p>USER可以这么获取</p>

<p>USER=<code>svnlook author -t $TXN $REPOS</code></p>

<p>SCMLIST=&quot;user1,user2,user3&quot; #scm人员列表</p>

<p>if [ <code>echo $SCMLIST|grep -w  $USER|wc -l</code> -eq 0 ]#如果不是scm操作，就做如下判断</p>

<p>then</p>

<p>SVNLOOK=/usr/bin/svnlook</p>

<p>LOG=<code>$SVNLOOK log -t &quot;$TXN&quot; &quot;$REPOS&quot;</code></p>

<p>LOGMSG=<code>$SVNLOOK log -t &quot;$TXN&quot; &quot;$REPOS&quot; | grep &quot;[a-zA-Z0-9]&quot; | wc -c</code></p>

<p>if [ <code>$SVNLOOK changed -t $TXN $REPOS |grep &quot;^D &quot;|wc -l</code> -gt 0 ]</p>

<pre><code class="language-text">    then

    echo -e &quot;\n You Don&#39;t have the pemmision of delete  &quot; 1&amp;gt;&amp;2

    exit 1
</code></pre>

<p>fi</p>

<p>fi</p>

<p>2.提交完毕邮件通知</p>

<p><a href="http://bbs.scmlife.com/thread-14543-1-1.html">http://bbs.scmlife.com/thread-14543-1-1.html</a></p>

<p>见此帖子</p>

<p>3.增量备份</p>

<p>4.在自动编译时，如果某目录正在编译，则禁止开发往该目录提交文件</p>

<p>pre-commit</p>

<p>REPOS=&quot;$1&quot;</p>

<p>TXN=&quot;$2&quot;</p>

<p>RES=&quot;OK&quot;</p>

<p>st=&quot;k2/branch/BR-K2-1_0_001_20100316/&quot;</p>

<p>ABSUSER=\((\)SVNLOOK author \(REPOS -t \)TXN)</p>

<p>if [ $ABSUSER != &quot;ads&quot; ]</p>

<p>then</p>

<pre><code class="language-text">    if [ &quot;`echo $files|grep $st`&quot; =   &quot;$files&quot; ]

    then

            echo -e &quot;\n The Path $st Is Being Build Now,Please Commit Later&quot; 1&amp;gt;&amp;2

            exit 1

    fi
</code></pre>

<p>fi</p>

<p>exit 0</p>

<p>自动构建的脚本 会去sed这个pre-commit里面的st变量。就可以达到类似的效果。</p>

<p>5.钩子脚本 对锁的管理</p>

<p><a href="http://bbs.scmlife.com/viewthrea">http://bbs.scmlife.com/viewthrea</a> ... highlight=%2Bgo2cxg</p>

<p>见这个帖子 有详细的说明。</p>

<p>6.禁止新增大于100M的文件入库（为了防止开发提交二进制码入库所做限制）</p>

<p>pre-commit</p>

<p>REPOS=&quot;$1&quot;</p>

<p>TXN=&quot;$2&quot;</p>

<p>RES=&quot;OK&quot;</p>

<p>MAX_SIZE=10240000</p>

<p>files=\((\)SVNLOOK changed -t \(TXN \)REPOS |grep &quot;<sup>A</sup> &quot;|awk &#39;{print $2}&#39;)</p>

<p>for f in $files</p>

<p>do</p>

<p>filesize=\((\)SVNLOOK cat -t \(TXN \)REPOS $f | wc -c)</p>

<p>if [ \(filesize -gt \)MAX_SIZE ] ; then</p>

<p>echo &quot;The new add file \(f is too large (must &amp;lt;= \)MAX_SIZE)&quot; &gt;&gt; /dev/stderr</p>

<p>exit 1</p>

<p>fi</p>

<p>done</p>

<p>当然 这里还可以做一些其他的限制</p>

<p>比如 你想禁止提交.a 或者 .so的文件入库 都可以在这里做类似的限制</p>

    </div>
    <footer class="post-footer clearfix">
      
           
      
        
    </footer>
     <div class="comments-wrap">
        <div class="share-comments">
          

          

          
        </div>
      </div><!-- end comments wrap -->
  </article>
 </div><!-- end-->



    <footer class="footer">
            <div class="container">
                <div class="site-footer-wrapper">
                        <a class="button-square" href="index.html">
<svg class="svg-inline--fa fa-home fa-w-18" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>
                            </a>
                        
                         
                        
                        
                        
                        <a class="button-square" href="https://github.com/showx" target="_blank" title="github">
                               <svg class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-github fa-lg"></i> -->
                          </a>
                        
                        
                      
                      <a class="button-square" href="atom.xml" target="_blank" title="RSS">
                              <svg class="svg-inline--fa fa-rss fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg><!-- <i class="fas fa-rss fa-lg"></i> -->
                      </a>

              
                       
                                                
                </div>
                <div class="site-menu-wrapper">
                  &nbsp;<span>|</span>&nbsp;
                  
                    <a target="self" class="" href="index.html">Home</a>
                    &nbsp;<span>|</span>&nbsp;
                  
                    <a target="_self" class="" href="archives.html">Archives</a>
                    &nbsp;<span>|</span>&nbsp;
                                             
                </div>

                <p class="footer-copyright">
                        Copyright &copy; 2019
                        Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
                        Theme used <a target="_blank" href="https://blog.timac.org">Timac</a>.
                </p>
            </div>
        </footer>



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  













<script src="asset/prism.js"></script>

        
      
  
    


    </body>
</html>
